(function(a){a(function(){a(".permissions-table input:checkbox").change(function(){a(this).parents("td").toggleClass("active",this.checked)}).change();a(".permissions-table tr:even").addClass("evenrow");a(".permissions-table :checked").parents("td").addClass("defaultSelected");a(".permissions-table .permissionDescription").hover(function(b){a(this).parents("tr").children("td").toggleClass("rowHover","mouseenter"===b.type)});a(".permissions-table th").hover(function(b){var c=a(this).prevAll().size();
a("."+c).add(this).toggleClass("rowHover","mouseenter"===b.type)});a(".permissions-table th#permission").hover(function(b){a(".permissions-table td.checkboxCell").toggleClass("rowHover","mouseenter"===b.type)});a(".permissions-table th#permission a").click(function(b){a(".permissions-table .checkGrid input").prop("checked",0===a(".checkGrid :checked").length).change();b.preventDefault()});a(".permissions-table .permissionDescription a").click(function(b){var c=0<a(this).parents("tr").find("input:checked").not("[disabled]").length;
a(this).parents("tr").find("input:checkbox").not("[disabled]").prop("checked",!c).change();b.preventDefault()});a(".permissions-table th.role a").click(function(b){var c=a(this).parent("th").prevAll().size(),d=0<a(".permissions-table ."+c+" input:checked").not("[disabled]").length;a(".permissions-table ."+c+" input").not("[disabled]").prop("checked",!d).change();b.preventDefault()});a("#clearall").click(function(b){a(".permissions-table input").not("[disabled]").prop("checked",!1).change();b.preventDefault()})})})($PBJQ);
$PBJQ("#footerAppPresence").on("click",function(){$PBJQ("#presenceArea").toggleClass("is-hidden")});
(function(a){if(portal.loggedIn){portal.connectionManager=portal.connectionManager||{};var b=Handlebars.templates["connection-manager-connection"],c=Handlebars.templates["connection-manager-searchresult"],d={},e={},f={},g={};a(function(){portal.i18n.loadProperties({resourceClass:"org.sakaiproject.portal.api.PortalService",resourceBundle:"connection-manager",namespace:"connection-manager",callback:function(){portal.i18n.loadProperties({resourceClass:"org.sakaiproject.portal.api.PortalService",resourceBundle:"profile-popup",
namespace:"connection-manager"})}})});var k=0,m=[],u="connections",K=0,v="";portal.connectionManager.show=function(L){var M=a("#connection-manager");M.modal({width:320});var w=a("#connection-manager-connectionsview"),x=a("#connection-manager-searchresultsview"),N=a("#connection-manager-searchresultsview-count"),D=a("#connection-manager-navbar-current \x3e span \x3e a"),n=a("#connection-manager-navbar-pending \x3e span \x3e a"),E=function(a){if(0===a)N.html(portal.i18n.tr("connection-manager","connection_manager_no_results"));
else{var b={count:a,criteria:portal.connectionManager.searchCriteria};a=1<a?portal.i18n.tr("connection-manager","connection_manager_results_count",b):portal.i18n.tr("connection-manager","connection_manager_result_count",b);N.html(a)}},Q=function(){O.hide();P.show();w.show();x.hide();D.parent().addClass("current");n.parent().removeClass("current")},F=function(){P.hide();O.show();w.show();x.hide();n.parent().addClass("current");D.parent().removeClass("current")},R=function(c,d){d=Object.keys(e).length;
a("#connection-manager-connection-"+c).remove();1===q.children().length&&l.hide();var h=f[c];h.connected=!1;h.hideConnect=!0;h.outgoing=!0;e[c]=h;h=b(h);0===d&&(r.show().html(""),y.hide());r.append(h);A();("connections"===u||"searchresults"==u&&0===G.children().length)&&F();a("#connection-manager-cancel-button-"+c).click(H)};D.click(function(a){Q()});n.click(function(a){F()});var l=a("#connection-manager-connectionsview-searchresults-wrapper"),q=a("#connection-manager-connectionsview-searchresults"),
G=a("#connection-manager-searchresultsview-results");M.click(function(a){if("connection-manager-connectionsview-searchbox"!==a.target.id){var b=l[0].getBoundingClientRect();t[0].getBoundingClientRect();(a.pageX<b.left||a.pageY<b.top||a.pageX>b.left+b.width||a.pageY>b.top+b.height)&&l.hide()}});var B=a("#connection-manager-current-connections"),P=a("#connection-manager-current-connections-wrapper"),C=a("#connection-manager-no-current-connections-wrapper"),r=a("#connection-manager-pending-connections"),
O=a("#connection-manager-pending-connections-wrapper"),y=a("#connection-manager-no-pending-connections-wrapper"),t=a("#connection-manager-connectionsview-searchbox");t.clearSearch({callback:function(){l.hide()}});var S=a("#connection-manager-searchresultsview-searchbox");0==K&&(v=n.html(),K+=1);var T=function(c){a("#connection-manager-connection-"+c).remove();0==k&&B.html("");var h=e[c];h.outgoing=!1;h.incoming=!1;h.connected=!0;var f=b(h);B.append(f);k+=1;a("#connection-manager-remove-button-"+c).click(I);
C.hide();delete e[c];1===q.children().length&&l.hide();d[c]=h;A();Q()},U=function(){var b=this.dataset.userId,c=this.dataset.displayName;a.ajax("/direct/profile/"+portal.user.id+"/confirmFriendRequest?friendId\x3d"+b,{cache:!1}).done(function(a){T(b)}).fail(function(a,b,d){console.log("ERROR: failed to confirm request from '"+c+"'. errorThrown: "+d)})},J=function(b){a(".connection-manager-connection-"+b).remove();delete e[b];1===q.children().length&&l.hide();A()},V=function(){var b=this.dataset.userId,
c=this.dataset.displayName;a.ajax("/direct/profile/"+portal.user.id+"/ignoreFriendRequest?friendId\x3d"+b,{cache:!1}).done(function(a){J(b)}).fail(function(a,b,d){console.log("ERROR: failed to ignore request from '"+c+"'. errorThrown: "+d)})},W=function(){var b=this.dataset.userId,c=this.dataset.displayName;a.ajax("/direct/profile/"+portal.user.id+"/requestFriend?friendId\x3d"+b,{cache:!1}).done(function(a){R(b,c)}).fail(function(a,b,d){console.log("ERROR: failed to request connection to '"+c+"'. errorThrown: "+
d)})},X=function(b){a("#connection-manager-connection-"+b).remove();--k;0==k&&C.show();delete d[b]},I=function(){var b=this.dataset.userId,c=this.dataset.displayName;confirm(portal.i18n.tr("connection-manager","connection_manager_remove_confirm",{displayName:c}))&&a.ajax("/direct/profile/"+portal.user.id+"/removeFriend?friendId\x3d"+b,{cache:!1}).done(function(a){X(b)}).fail(function(a,b,d){console.log("ERROR: failed to remove '"+c+"'. errorThrown: "+d)})},H=function(){var b=this.dataset.userId,c=
this.dataset.displayName;a.ajax("/direct/profile/"+b+"/ignoreFriendRequest?friendId\x3d"+portal.user.id,{cache:!1}).done(function(c){a(".connection-manager-connection-"+b).remove();delete e[b];A()}).fail(function(a,b,d){console.log("ERROR: failed to ignore request from '"+c+"'. errorThrown: "+d)})},A=function(){var a=Object.keys(e).length;0===a?(n.html(v),r.html("").hide(),y.show()):n.html(v+" ("+a+")")},Y=function(h,p){a("#connection-manager-profile-popup-container .qtip").remove();var k=p?G:q;if(4>
h.length)k.html(""),p?E(0):l.hide();else{portal.connectionManager.searchCriteria=h;var m=p?b:c;a.ajax("/direct/portal/connectionsearch.json?query\x3d"+h,{cache:!1}).done(function(c){k.html("");if(0===c.length)p||l.hide();else{p||l.show();var h="";g=c;f={};g.forEach(function(a){f[a.uuid]=a});p?g.forEach(function(a,b){h+=m(a)}):g.slice(0,5).forEach(function(a,b){h+=m(a)});p&&E(g.length);k.html(h);0<k.children().length&&k.show();a(function(){p?a(".connection-manager-connect-button").click(W):profile.attachPopups(a(".profile-popup-trigger"),
{hide:!0,container:"connection-manager-profile-popup-container",callbacks:{connect:R,cancel:J,accept:T,ignore:J,remove:X}});a("#connection-manager-connectionsview-searchresults-more").click(function(c){u="searchresults";q.html("");l.hide();w.hide();x.show();S.val(portal.connectionManager.searchCriteria);t.val("");a(function(){E(g.length);var c="";g.forEach(function(a,f){a.facebookSet=a.socialNetworkingInfo.facebookUrl;a.twitterSet=a.socialNetworkingInfo.twitterUrl;a.moreResult=!0;d.hasOwnProperty(a.uuid)&&
(a.connected=!0,a.hideConnect=!0);e.hasOwnProperty(a.uuid)&&(a.connected=!1,a.hideConnect=!0,a.outgoing=e[a.uuid].outgoing,a.incoming=e[a.uuid].incoming);c+=b(a)});G.html(c);a(function(){a(".connection-manager-accept-button").click(U);a(".connection-manager-ignore-button").click(V);a(".connection-manager-connect-button").click(W);a(".connection-manager-remove-button").click(I);a(".connection-manager-cancel-button").click(H)})})});a("#connection-manager-backtoconnections-link").click(function(a){u=
"connections";x.hide();w.show();l.hide();q.html("");t.val("")})})}})}};a.ajax("/direct/profile/"+portal.user.id+"/connections.json",{cache:!1}).done(function(c){d={};k=c.length;searchUserIdFilter=[portal.user.id];B.html("");m=c;0==m.length?C.show():C.hide();c.forEach(function(a){a.facebookSet=a.socialNetworkingInfo.facebookUrl;a.twitterSet=a.socialNetworkingInfo.twitterUrl;a.current=!0;a.connected=!0;a.incoming=!1;a.hideConnect=!0;d[a.uuid]=a;B.append(b(a))});a(function(){a(".connection-manager-remove-button").click(I)})}).fail(function(a,
b,c){console.log("ERROR: failed to get current connections. errorThrown: "+c)});var Z=function(c){0==c.length?(y.show(),r.hide()):(y.hide(),r.show().html(""));c.forEach(function(a){a.hideConnect=!0;a.pending=!0;r.append(b(a));e[a.uuid]=a});0<c.length?n.html(v+" ("+c.length+")"):n.html(v);a(function(){a(".connection-manager-accept-button").click(U);a(".connection-manager-ignore-button").click(V);a(".connection-manager-cancel-button").click(H)})};a.ajax("/direct/profile/"+portal.user.id+"/incomingConnectionRequests.json",
{cache:!1}).done(function(b){e={};b.forEach(function(a){a.incoming=!0});a.ajax("/direct/profile/"+portal.user.id+"/outgoingConnectionRequests.json",{cache:!1}).done(function(a){a.forEach(function(a){a.outgoing=!0;b.push(a)});Z(b)}).fail(function(a,b,c){console.log("Failed to get outgoing requests. errorThrown: "+c)})}).fail(function(a,b,c){console.log("Failed to get incoming requests. errorThrown: "+c)});t.keyup(function(a){Y(this.value,!1)});t.keydown(function(b){13==b.which&&4<=this.value.length&&
a("#connection-manager-connectionsview-searchresults-more").click()});S.keyup(function(a){Y(this.value,!0)});L&&"pending"===L.state&&F()};a("#Mrphs-userNav__submenuitem--connections").click(portal.connectionManager.show)}})($PBJQ);
$PBJQ(document).ready(function(){var a=$PBJQ("#Mrphs-footer--details__info");1===a.length&&(a.popover({html:!0,content:function(){return $PBJQ("#Mrphs-footer--details__panelTemplate").html()}}),a.click(function(a){a.preventDefault()}));updateFooterTime=function(){if(1==$PBJQ("#preferredTime").length)var a=$PBJQ("#preferredTime").data("preferredtzdisplay"),c=(new Date(parseInt($PBJQ("#preferredTime").data("preferredserverdateandgmtoffset")))).getTime()-(new Date).getTime();var d=$PBJQ("#serverTime").data("servertzdisplay"),
e=(new Date(parseInt($PBJQ("#serverTime").data("serverdateandgmtoffset")))).getTime()-(new Date).getTime();return function(){var b=new Date((new Date).getTime()+e),b=b.toUTCString().replace(/GMT/,d).replace(/UTC/,d);$PBJQ("#serverTime").text(b);1==$PBJQ("#preferredTime").length&&(b=new Date((new Date).getTime()+c),b=b.toUTCString().replace(/GMT/,a).replace(/UTC/,a),$PBJQ("#preferredTime").text(b));setTimeout("updateFooterTime()",1E3)}}();1==$PBJQ("#serverTime").length&&updateFooterTime()});
(function(a){portal.loggedIn?(window.sakai=window.sakai||{},window.sakai.translations=window.sakai.translations||{},portal.i18n.loadProperties=function(a){if(a.namespace){var b={resourceClass:"org.sakaiproject.i18n.InternationalizedMessages",resourceBundle:"org.sakaiproject.".concat(a.namespace).concat(".bundle.Messages"),namespace:a.namespace};a=Object.assign(b,a);a.debug&&(console.debug("resourceClass: "+a.resourceClass),console.debug("resourceBundle: "+a.resourceBundle),console.debug("namespace: "+
a.namespace));window.sakai.translations[a.namespace]=window.sakai.translations[a.namespace]||{};var d=portal.locale+a.resourceBundle;null!==sessionStorage.getItem(d)?(a.debug&&console.debug("Returning "+d+" from sessions storage ..."),window.sakai.translations[a.namespace]=JSON.parse(sessionStorage[d]),a.callback&&a.callback()):(a.debug&&console.debug(d+" not in sessions storage. Pulling from webservice ..."),$PBJQ.ajax({url:"/sakai-ws/rest/i18n/getI18nProperties"+portal.portalCDNQuery,cache:!0,contentType:"application/json",
data:{locale:portal.locale,resourceclass:a.resourceClass,resourcebundle:a.resourceBundle}}).done(function(b,c,g){b.split("\n").forEach(function(b){b=b.split("\x3d");2==b.length&&(window.sakai.translations[a.namespace][b[0]]=b[1]);a.debug&&(console.debug("Updated translations: "),console.debug(window.sakai.translations[a.namespace]))});sessionStorage[d]=JSON.stringify(window.sakai.translations[a.namespace]);a.callback&&a.callback()}).fail(function(a,b,c){console.error(c)}))}else console.error("You must supply at least a namespace. Doing nothing ...")},
portal.i18n.tr=function(a,c,d){if(a&&c){var b=window.sakai.translations[a][c];if(!b)return console.warn(a+"#key "+c+" not found. Returning key ..."),c;if(void 0!=d)for(var f in d)b=b.replace("{"+f+"}",d[f]);return b}console.error("You must supply a namespace and a key. Doing nothing.")},Handlebars.registerHelper("tr",function(a,c,d){return new Handlebars.SafeString(portal.i18n.tr(a,c,d.hash))})):localStorage.removeItem("last-sakai-user")})($PBJQ);var profile=profile||{};
(function(a){profile.requestFriend=function(b,c,d){return new Promise(function(e,f){a.ajax({url:"/direct/profile/"+b+"/requestFriend?friendId\x3d"+c,dataType:"text",cache:!1}).done(function(b,f,m){a("#profile-popup-request-button-"+c).hide();a("#profile-popup-cancel-button-"+c).show();d&&d(c);e(!0)}).fail(function(a,b,c){return f()})})};profile.confirmFriendRequest=function(b,c,d){return new Promise(function(e,f){a.ajax({url:"/direct/profile/"+b+"/confirmFriendRequest?friendId\x3d"+c,dataType:"text",
cache:!1}).done(function(b,f,m){a("#profile-popup-incoming-block-"+c).hide();a("#profile-popup-remove-button-"+c).show();d&&d(c);e(!0)}).fail(function(a,b,c){return f()})})};profile.removeFriend=function(b,c,d,e){return new Promise(function(e,g){a.ajax({url:"/direct/profile/"+b+"/removeFriend?friendId\x3d"+c,dataType:"text",cache:!1}).done(function(b,f,g){a("#profile-popup-remove-button-"+c).hide();a("#profile-popup-request-button-"+c).show();d&&d(c);e(!0)}).fail(function(a,b,c){return g()})})};profile.ignoreFriendRequest=
function(b,c,d,e){return new Promise(function(f,g){a.ajax({url:"/direct/profile/"+b+"/ignoreFriendRequest?friendId\x3d"+c,cache:!1}).done(function(g,m,u){void 0!==d&&1==d?(a("#profile-popup-cancel-button-"+b).hide(),a("#profile-popup-request-button-"+b).show(),e&&e(b)):(a("#profile-popup-incoming-block-"+c).hide(),a("#profile-popup-request-button-"+c).show(),e&&e(c));f(!0)}).fail(function(a,b,c){return g()})})};profile.attachPopups=function(b,c){if(b instanceof a){c||(c={});var d=c.hide,e=c.callbacks;
e||(e={});b.each(function(){var b=this.dataset.userId,g=a(this).find(".profile-popup-target"),g={target:0<g.length?g.eq(0):a(this),my:"top left",at:"bottom center",viewport:a(window),adjust:{method:"flipinvert none"}};c&&c.container&&(g.container=a("#"+c.container));a(this).qtip({position:g,show:{event:"click",delay:0},suppress:!1,style:{classes:"profile-popup-qtip qtip-shadow"},hide:{event:"click unfocus"},content:{text:function(c,d){return a.ajax({url:"/direct/portal/"+b+"/formatted",cache:!1}).then(function(a){return a},
function(a,b,c){d.set("content.text",b+": "+c)})}},events:{visible:function(c,f){a("#profile-popup-request-button-"+b).off("click").on("click",function(a){profile.requestFriend(portal.user.id,b,e.connect).then(function(){d&&f.hide()})});a("#profile-popup-cancel-button-"+b).off("click").on("click",function(a){profile.ignoreFriendRequest(b,portal.user.id,!0,e.cancel).then(function(){d&&f.hide()})});a("#profile-popup-accept-button-"+b).off("click").on("click",function(a){profile.confirmFriendRequest(portal.user.id,
b,e.accept).then(function(){d&&f.hide()})});a("#profile-popup-ignore-button-"+b).off("click").on("click",function(a){profile.ignoreFriendRequest(portal.user.id,b,!1,e.ignore).then(function(){d&&f.hide()})});a("#profile-popup-remove-button-"+b).off("click").on("click",function(a){profile.removeFriend(portal.user.id,b,e.remove).then(function(){d&&f.hide()})})}}})})}else console.log("profile.attachPopups takes a jQuery object array, from a selector")}})($PBJQ);
function publishSite(a){$PBJQ.ajax({type:"POST",data:"published\x3dtrue",url:"/direct/site/"+a+"/edit",success:function(){location.reload()}})}function quickLinksNavEscHandler(a){27===a.keyCode&&toggleQuickLinksNav(a)}
function toggleQuickLinksNav(a){a.preventDefault();$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")||toggleUserNav(a);$PBJQ(".Mrphs-quickLinksNav__subnav").toggleClass("is-hidden");$PBJQ(".Mrphs-quickLinksNav__subnav").hasClass("is-hidden")?($PBJQ(".quicklinks-dropdown-overlay").remove(),$PBJQ("body").css("overflow-y","visible"),$PBJQ(document).off("keyup",quickLinksNavEscHandler)):(a=$PBJQ('\x3cdiv class\x3d"quicklinks-dropdown-overlay" /\x3e'),a.on("click",function(a){toggleQuickLinksNav(a)}),
$PBJQ("body").prepend(a),$PBJQ("body").css("overflow-y","hidden"),$PBJQ(document).on("keyup",quickLinksNavEscHandler),$PBJQ(".tab-box").css("max-height",window.innerHeight-$PBJQ("#selectQuickLink").offset().top-14))}$PBJQ("#quickLinks-close").on("click",toggleQuickLinksNav);$PBJQ(".js-toggle-quick-links-nav").on("click",toggleQuickLinksNav);
$PBJQ(document).ready(function(){$PBJQ('[id$\x3d"reorder-list"] .reorder-element').each(function(a){$PBJQ("#lastMoveArrayInit").append($PBJQ(this).attr("id")+" ");$PBJQ("#lastMoveArray").append($PBJQ(this).attr("id")+" ")});$PBJQ('input[id^\x3d"index"]').click(function(a){a.stopPropagation()});$PBJQ('input[id^\x3d"index"]').bind("keypress",function(a){return 13==(a.charCode||a.keyCode)?!1:!0});$PBJQ("#undo-all").click(function(a){var b;b=$PBJQ.trim($PBJQ("#lastMoveArrayInit").text()).split(" ");for(z in b)thisRow=
document.getElementById(b[z]),$PBJQ(thisRow).appendTo('[id$\x3d"reorder-list"]');a.preventDefault();registerChange();$PBJQ("#undo-all").hide();$PBJQ("#undo-all-inact").show();$PBJQ("#undo-last-inact").show();$PBJQ("#undo-last").hide()});$PBJQ("#undo-last").click(function(a){var b;b=$PBJQ.trim($PBJQ("#lastMoveArray").text()).split(" ");for(z in b)thisRow=document.getElementById(b[z]),$PBJQ(thisRow).appendTo('[id$\x3d"reorder-list"]');b=$PBJQ.trim($PBJQ("#lastItemMoved").text());b=$PBJQ(".reorder-element:eq("+
b.substr(20)+")");$PBJQ(b).addClass("recentMove");a.preventDefault();registerChange("notfluid",b);$PBJQ("#undo-last-inact").fadeIn("slow");$PBJQ("#undo-last").hide()});$PBJQ('input[id^\x3d"index"]').change(function(){var a=this;preserveStatus();var b=parseInt($PBJQ(this).siblings('input[id^\x3d"holder"]').attr("value")),c=parseInt(this.value);if(isNaN(c)||c>$PBJQ('input[id^\x3d"index"]').size())return c=$PBJQ("#messageHolder").text(),$PBJQ("#messageHolder").text(c.replace("#",$PBJQ('input[id^\x3d"index"]').size())),
$PBJQ(".orderable-selected").removeClass("orderable-selected"),$PBJQ("#messageHolder").fadeIn("slow"),$PBJQ("#messageHolder").animate({opacity:1},2E3,function(){$PBJQ(a).val(b);a.focus();a.select()}),$PBJQ("#messageHolder").fadeOut("slow"),$PBJQ(this).parents(".reorder-element").addClass("orderable-selected"),null;var d=$PBJQ('input[id^\x3d"index"]');$PBJQ("#undo-last").fadeIn("slow");$PBJQ("#undo-last-inact").hide();$PBJQ("#undo-all").fadeIn("slow");$PBJQ("#undo-all-inact").hide();var e=$PBJQ(this).parents(".reorder-element");
"1"===c?$PBJQ(e).insertBefore(e.siblings(".reorder-element").find("input[value\x3d"+c+"]").parents(".reorder-element")):c==d.length?$PBJQ(e).insertAfter(e.siblings(".reorder-element").find("input[value\x3d"+c+"]").parents(".reorder-element")):c>b?$PBJQ(e).insertAfter(e.siblings(".reorder-element").find("input[value\x3d"+c+"]").parents(".reorder-element")):$PBJQ(e).insertBefore(e.siblings(".reorder-element").find("input[value\x3d"+c+"]").parents(".reorder-element"));registerChange("notfluid",$PBJQ(this).parents(".reorder-element"))});
return $PBJQ('[id$\x3d"reorder-list"]').length?$PBJQ('[id$\x3d"reorder-list"]').sortable({items:".reorder-element:not(.notsortable)",start:function(a,b){preserveStatus(b)},update:function(a,b){registerChange(a,b)}}):null});
var registerChange=function(a,b){$PBJQ('[id$\x3d"reorder-list"] .reorder-element').size();"notfluid"!==a&&(b=$PBJQ(document.activeElement).closest('[id^\x3d"ui-id-"]'));$PBJQ("#lastItemMoved").text($PBJQ(b).attr("id")).trigger("change");$PBJQ(b).addClass("recentMove");$PBJQ(b.prevAll(".reorder-element").length+1);var c=$PBJQ('input[id^\x3d"index"]'),d=$PBJQ('input[id^\x3d"holder"]');a=$PBJQ("select.selectSet");for(var e=0;e<c.length;e+=1)$PBJQ(c[e]).attr("value",e+1).val(e+1);for(c=0;c<d.length;c+=
1)$PBJQ(d[c]).attr("value",c+1).val(c+1);for(d=0;d<a.length;d+=1)$PBJQ(a[d]).val(d+1),$PBJQ(a[d]).find("option").removeAttr("selected"),$PBJQ(a[d]).find("option[value\x3d"+(d+1)+"]").attr("selected","selected");$PBJQ("#undo-last").fadeIn("slow");$PBJQ("#undo-last-inact").hide();$PBJQ("#undo-all").fadeIn("slow");$PBJQ("#undo-all-inact").hide();$PBJQ(b).animate({opacity:1},2E3,function(){$PBJQ(b).removeClass("recentMove")})},preserveStatus=function(a){$PBJQ("#lastMoveArray").text("");$PBJQ('[id$\x3d"reorder-list"] .reorder-element').each(function(a){void 0!==
$PBJQ(this).attr("id")&&"undefined_avatar"!==$PBJQ(this).attr("id")&&$PBJQ("#lastMoveArray").append($PBJQ(this).attr("id")+" ")})};function toggleToolsNav(a){a&&a.preventDefault();MorpheusViewportHelper.isDesktop()||($PBJQ("body").toggleClass("toolsNav--displayed"),$PBJQ("body").hasClass("toolsNav--displayed")?createDHTMLMask(toggleToolsNav):removeDHTMLMask())}
$PBJQ(document).ready(function(){function a(){function a(){$PBJQ("#roleSwitchDropDown").is(".open")&&$PBJQ("#roleSwitchDropDownToggle").trigger("click")}function c(b){return 27==b.keyCode?(a(),!1):!0}$PBJQ("#roleSwitchDropDownToggle").attr("aria-hidden","false").attr("aria-haspopup","true");$PBJQ("#roleSwitchDropDown").attr("aria-hidden","true");$PBJQ("#roleSwitchDropDownToggle").click(function(){$PBJQ("#roleSwitchDropDown").css("right",$PBJQ(window).width()-20-($PBJQ("#roleSwitchDropDownToggle").offset().left+
$PBJQ("#roleSwitchDropDownToggle").width()));$PBJQ("#roleSwitchDropDown").toggleClass("open");$PBJQ("#roleSwitchDropDown").is(".open")?($PBJQ("#roleSwitchDropDown").attr("aria-hidden","false"),$PBJQ(document.body).prepend('\x3cdiv class\x3d"user-dropdown-overlay"\x3e\x3c/div\x3e'),$PBJQ(".user-dropdown-overlay").on("click",function(){a()}),$PBJQ(document.body).on("keyup",c),setTimeout(function(){$PBJQ("#roleSwitchDropDown").find("a, :input").focus()})):($PBJQ("#roleSwitchDropDown").attr("aria-hidden",
"true"),$PBJQ(".user-dropdown-overlay").remove(),$PBJQ(document.body).off("keyup",c),$PBJQ("#roleSwitchDropDownToggle").focus())})}$PBJQ("#roleSwitchSelect").on("change",function(){""!==$PBJQ("option:selected",this).text()?document.location=$PBJQ("option:selected",this).val()+"#roleSwitch":$PBJQ(this)[0].selectedIndex=0});MorpheusViewportHelper.isPhone()?a():$PBJQ("#roleSwitch").addClass("menu-not-setup")});$PBJQ(".js-toggle-tools-nav","#skipNav").on("click",toggleToolsNav);
var sessionId="current",sessionTimeOut,timeoutDialogEnabled=!1,timeoutDialogFragment,timeoutDialogWarningTime,timeoutLoggedoutUrl,timeoutPortalPath;$PBJQ(document).ready(function(){portal.loggedIn&&portal.timeoutDialog&&setTimeout("setup_timeout_config();",3E5)});
var setup_timeout_config=function(){portal&&portal.timeoutDialog&&(timeoutDialogEnabled=portal.timeoutDialog.enabled,timeoutDialogWarningTime=portal.timeoutDialog.seconds,timeoutLoggedoutUrl=portal.loggedOutUrl,timeoutPortalPath=portal.portalPath,1==timeoutDialogEnabled&&poll_session_data())};
function createDHTMLMask(a){var b=document.createElement("div");b.id="portalMask";b.style.height=document.documentElement.scrollHeight+"px";b.style.width="100%";b.style.zIndex="1300";b.style.top="0";b.style.left="0";b.style.position="absolute";b.style.backgroundColor="rgba(0, 0, 0, 0.5)";b.style.display="flex";b.style.alignItems="center";b.style.justifyContent="center";b.addEventListener("click",function(a){closeDrawer();a.stopPropagation()});document.body.appendChild(b);"function"===typeof a&&a()}
function removeDHTMLMask(){var a=document.getElementById("portalMask");a&&document.body.removeChild(a)}
var poll_session_data=function(){$PBJQ.ajax({url:"/direct/session/"+sessionId+".json?auto\x3dtrue",dataType:"json",cache:!1,success:function(a){a.maxInactiveInterval*=1E3;a.active&&null!=a.userId&&a.lastAccessedTime+a.maxInactiveInterval>a.currentTime?(a=a.lastAccessedTime+a.maxInactiveInterval-a.currentTime,a<1E3*timeoutDialogWarningTime?(min=Math.round(a/6E4),timeoutDialogFragment?show_timeout_alert(min):$PBJQ.ajax({url:"/portal/timeout?auto\x3dtrue",cache:!0,dataType:"text"}).done(function(a){timeoutDialogFragment=
a;show_timeout_alert(min)}).fail(function(){timeoutDialogEnabled=!1}),clearTimeout(sessionTimeOut),sessionTimeOut=setTimeout("poll_session_data()",Math.max(a/2,6E4))):(clearTimeout(sessionTimeOut),sessionTimeOut=setTimeout("poll_session_data()",a-1E3*timeoutDialogWarningTime))):null==a.userId?location.href=timeoutLoggedoutUrl:sessionTimeOut=setTimeout("poll_session_data()",1E4)},error:function(a,b,c){}})};function keep_session_alive(){dismiss_session_alert();$PBJQ.get(timeoutPortalPath)}
var dismiss_session_alert=function(){removeDHTMLMask();$PBJQ("#timeout_alert_body").remove()};function show_timeout_alert(a){timeoutDialogEnabled&&timeoutDialogFragment&&($PBJQ("#portalMask").get(0)||(createDHTMLMask(dismiss_session_alert),$PBJQ("#portalMask").css("z-index",1300)),$PBJQ("#timeout_alert_body").get(0)?$PBJQ("#timeout_alert_body span").html(a):(a=timeoutDialogFragment.replace("{0}",a),$PBJQ("body").append(a)))}
function toggleShortUrlOutput(a,b,c){$PBJQ(b).is(":checked")?$PBJQ.ajax({url:"/direct/url/shorten?path\x3d"+encodeURI(a),dataType:"text",success:function(a){$PBJQ("."+c).val(a)}}):$PBJQ("."+c).val(a)}
$PBJQ(document).ready(function(){$PBJQ(".link--directurl").click(function(a){var b=$PBJQ(this).position(),c=$PBJQ(this).siblings(".Mrphs-directUrl");c.toggleClass("active").css({left:b.left+"px"});c.attr("aria-expanded","true");c.find("[tabindex]").first().focus();a.preventDefault()});$modal_container=$PBJQ(".Mrphs-directUrl");$modal_container.each(function(a){var b=$PBJQ(this).find("[tabindex]");b.first().on("keydown",function(a){if(9===a.keyCode&&a.shiftKey)return b.last().focus(),a.preventDefault(),
!1});b.last().on("keydown",function(a){if(9===a.keyCode&&!a.shiftKey)return b.first().focus(),a.preventDefault(),!1})});$modal_container.last().on("keypress",function(a){if(9===a.keyCode())return console.log("keypress:: primero"),$modal_container.fist().focus(),a.preventDefault(),!1});$PBJQ(".Mrphs-directUrl .dropDown_close").on("click keypress",function(a){var b=$PBJQ(this).parent();b.toggleClass("active");b.removeAttr("aria-expanded");$PBJQ('.link--directurl[rel\x3d"#'+b.attr("id")+'"]').focus();
a.preventDefault()})});
var closeAllDropdownMenus=function(){$PBJQ(".Mrphs-sitesNav__menuitem").removeClass("dropdown-is-visible");$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-visible").removeClass("is-visible");$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-clicked").removeClass("is-clicked");$PBJQ(".sitenav-dropdown-overlay").remove()},buildDropdownMenu=function(a,b,c){var d='\x3cul class\x3d"Mrphs-sitesNav__submenu" role\x3d"menu"\x3e',e=parseInt($PBJQ("#linkNav").attr("data-max-tools-int")),f=$PBJQ("#linkNav").attr("data-max-tools-anchor"),g=
'\x3cli class\x3d"Mrphs-sitesNav__submenuitem Mrphs-sitesNav__submenuitem__gotosite"\x3e\x3ca tabindex\x3d"-1" role\x3d"menuitem" href\x3d"'+portal.portalPath+"/site/"+b+'" title\x3d"'+f+'"\x3e\x3cspan class\x3d"toolMenuIcon icon-sakai--see-all-tools"\x3e\x3c/span\x3e'+f+"\x3c/a\x3e\x3c/li\x3e";b="/direct/site/"+b+"/pages.json";var k=window.location.pathname.split("/").pop();$PBJQ.ajax({url:b,dataType:"json",success:function(b){$PBJQ.each(b,function(a,b){if(b.tools&&!(0>=b.tools.length)){var c="";
k==b.tools[0].id&&(c=" is-current");a<=e&&(d+=(b.toolpopup?'\x3cli class\x3d"Mrphs-sitesNav__submenuitem" \x3e\x3ca tabindex\x3d"-1" class\x3d"Mrphs-sitesNav__submenuitem-link" role\x3d"menuitem" href\x3d"{{tool_url}}?sakai.popup\x3dyes" title\x3d"{{item_title}}" onclick\x3d"window.open(\'{{item_toolpopupurl}}\');"\x3e  \x3cspan class\x3d"Mrphs-sitesNav__submenuitem-icon"\x3e\x3cspan class\x3d"toolMenuIcon icon-sakai--{{icon}}"\x3e\x3c/span\x3e\x3c/span\x3e  \x3cspan class\x3d"Mrphs-sitesNav__submenuitem-title"\x3e{{item_title}}\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e':
'\x3cli class\x3d"Mrphs-sitesNav__submenuitem{{is_current}}"\x3e\x3ca tabindex\x3d"-1" class\x3d"Mrphs-sitesNav__submenuitem-link" role\x3d"menuitem" href\x3d"{{tool_url}}" title\x3d"{{item_title}}"\x3e  \x3cspan class\x3d"Mrphs-sitesNav__submenuitem-icon"\x3e\x3cspan class\x3d"toolMenuIcon icon-sakai--{{icon}}"\x3e\x3c/span\x3e\x3c/span\x3e  \x3cspan class\x3d"Mrphs-sitesNav__submenuitem-title"\x3e{{item_title}}\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e').replace(/{{tool_url}}/g,b.tools[0].url).replace(/{{item_title}}/g,
b.title).replace(/{{item_toolpopupurl}}/g,b.toolpopupurl).replace(/{{icon}}/g,b.tools[0].toolId.replace(/\./gi,"-")).replace(/{{is_current}}/g,c))}});b.length-1>e&&(d+=g);d+="\x3c/ul\x3e";d=$PBJQ(d);a.append(d);addArrowNavAndDisableTabNav(d);c(d)},error:function(a,b,c){}})},setupSiteNav=function(){$PBJQ("ul.Mrphs-sitesNav__menu").each(function(){$PBJQ(this).keydown(function(a){27==a.keyCode&&closeAllDropdownMenus()})});$PBJQ(document).on("keydown",".Mrphs-sitesNav__menu \x3e li.Mrphs-sitesNav__menuitem \x3e a",
function(a){40==a.keyCode?(a.preventDefault(),a=$PBJQ(this).parent().find(".Mrphs-sitesNav__dropdown"),a.data("clicked")||(a.data("clicked",!0),a.trigger("click"))):27==a.keyCode&&(a.preventDefault(),closeAllDropdownMenus())});$PBJQ("ul.Mrphs-sitesNav__menu li .Mrphs-sitesNav__dropdown").click(function(a){a.preventDefault();a=$PBJQ(a.target);var b=a.parent(".Mrphs-sitesNav__menuitem"),c=b.hasClass("dropdown-is-visible");closeAllDropdownMenus();if(!c){var d=$PBJQ(this),c=function(a){d.addClass("is-clicked");
b.addClass("dropdown-is-visible");a.addClass("is-visible");b.find("li a").first().focus();a=$PBJQ('\x3cdiv class\x3d"sitenav-dropdown-overlay" /\x3e');a.on("click",function(a){closeAllDropdownMenus()});$PBJQ("body").prepend(a);d.removeData("clicked")};b.find("ul").length?c(b.find("ul")):buildDropdownMenu(b,a.attr("data-site-id"),c)}}).hover(function(){$PBJQ(this).toggleClass("Mrphs-sitesNav__dropdown--hover")})};
function addArrowNavAndDisableTabNav(a){a.find("li a").attr("tabindex","-1").keydown(function(b){var c=$PBJQ(b.target);if(40==b.keyCode){b.preventDefault();b=c.closest("li").next();if(0===b.length||0==b.find("a").length)b=a.find("li").first();a.find("li a").attr("tabindex","-1");b.find("a").focus().attr("tabindex","0")}else 38==b.keyCode?(b.preventDefault(),b=c.closest("li").prev(),0===b.length&&(b=a.find("a").closest("ul")),a.find("li a").attr("tabindex","-1"),b.find("a").focus().attr("tabindex",
"0")):9==b.keyCode&&closeAllDropdownMenus()})}portal=portal||{};void 0===portal.toolsCollapsed&&(portal.toolsCollapsed=!1);portal.updateToolsCollapsedPref=function(a){portal.user.id&&$PBJQ.ajax("/direct/userPrefs/updateKey/"+portal.user.id+"/sakai:portal:sitenav?toolsCollapsed\x3d"+a,{method:"PUT",cache:!1})};
portal.toggleMinimizeNav=function(){$PBJQ("body").toggleClass("Mrphs-toolMenu-collapsed");$PBJQ("#subSites.floating").css({display:"none"});var a=$PBJQ("#toolsNav-toggle-li button");a.toggleClass("min max").parent().toggleClass("min max");portal.toolsCollapsed?(portal.updateToolsCollapsedPref(!1),portal.toolsCollapsed=!1,a.attr("aria-pressed",!1)):(portal.updateToolsCollapsedPref(!0),portal.toolsCollapsed=!0,a.attr("aria-pressed",!0))};
$PBJQ(document).ready(function(){$PBJQ("#toolsNav-toggle-li button").on("click",portal.toggleMinimizeNav);$PBJQ("#toggleSubsitesLink").click(function(a){a=$PBJQ(this);"block"==$PBJQ("#subSites").css("display")?($PBJQ("#subSites").hide(),$PBJQ("#subSites").removeClass("floating")):(a=a.position(),a=-1*($PBJQ("#toolMenu").height()-a.top),a=MorpheusViewportHelper.isPhone()?{display:"block",top:0,overflow:"hidden"}:{display:"block",left:$PBJQ("#toolMenu").width()+7+"px",top:a+"px"},$PBJQ("#subSites").css(a),
$PBJQ("#subSites").addClass("floating"),$PBJQ("#subSites").find("li a").first().focus(),240>$PBJQ("#toggleSubsitesLink").position().top&&$PBJQ("#subSites.floating").addClass("ontop"))})});var activeTabListenerAttached=!1,handleVisibilityChange=function(){};function updatePresenceTimeout(a,b){null!==window.sakaiLastPresenceTimeOut&&(clearTimeout(window.sakaiLastPresenceTimeOut),window.sakaiLastPresenceTimeOut=null);b&&(window.sakaiLastPresenceTimeOut=setTimeout("updatePresence()",a))}
function updatePresence(){activeTabListenerAttached||(document.addEventListener("visibilitychange",handleVisibilityChange,!1),activeTabListenerAttached=!0);document.hidden||$PBJQ.ajax({url:sakaiPresenceFragment,cache:!1,dataType:"text",success:function(a){var b=$PBJQ("#presenceIframe");b.html(a);a=$PBJQ("#presenceCount");b.is(":empty")?(a.html(" "),a.removeClass("present").addClass("empty"),location.reload()):(b=b.find(".listUser").length,1<b?(a.html(b+""),a.removeClass("empty").addClass("present")):
(1==b?$PBJQ("#presenceCount").html(b+""):$PBJQ("#presenceCount").html(" "),a.removeClass("present").addClass("empty")),b=$PBJQ(".nav-selected .icon-sakai-chat").attr("href"),$PBJQ("#presenceIframe .presenceList div.inChat span").wrap('\x3ca href\x3d"'+b+'"\x3e\x3c/a\x3e'),updatePresenceTimeout(3E4,!0))},error:function(a,b){updatePresenceTimeout(6E4,!0)}})}
handleVisibilityChange=function(a){document.hidden?updatePresenceTimeout(window.sakaiPresenceTimeDelay,!1):(updatePresenceTimeout(window.sakaiPresenceTimeDelay,!1),updatePresence())};function userNavEscHandler(a){27===a.keyCode&&toggleUserNav(a)}
function toggleUserNav(a){a.preventDefault();a=$PBJQ(".Mrphs-userNav__drop-btn");$PBJQ(".Mrphs-userNav__subnav").toggleClass("is-hidden");if($PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden"))$PBJQ(".user-dropdown-overlay").remove(),$PBJQ(document).off("keyup",userNavEscHandler),a.attr("aria-expanded","false"),a.focus();else{var b=$PBJQ('\x3cdiv class\x3d"user-dropdown-overlay" /\x3e');b.on("click",function(a){toggleUserNav(a)});$PBJQ("body").prepend(b);$PBJQ(document).on("keyup.usernav",userNavEscHandler);
a.attr("aria-expanded","true")}}$PBJQ("#loginLink1").click(function(a){""===$PBJQ(this).attr("data-warning")||confirm($PBJQ(this).attr("data-warning"))||a.preventDefault()});$PBJQ(".js-toggle-user-nav a#loginUser \x3e .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav);$PBJQ(".js-toggle-user-nav .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav);var header=$PBJQ(".Mrphs-topHeader"),currentHeaderWidth=-1;
$PBJQ(document).ready(function(){$PBJQ(header).data("sticked",!1);0<$PBJQ(".Mrphs-hierarchy--parent-sites").length&&800>=$PBJQ(window).width()&&$PBJQ("#content").css("margin-top",parseInt($PBJQ("#content").css("margin-top").replace("px",""))+$PBJQ(".Mrphs-hierarchy--parent-sites").outerHeight(!0)+"px");$PBJQ(window).resize(function(){currentHeaderWidth=$PBJQ(".Mrphs-mainHeader").width()});$PBJQ(window).scroll(function(){var a=!0===$PBJQ(document).height()-$PBJQ(window).height()>$PBJQ(header).height();
0<$PBJQ(window).scrollTop()?!1===$PBJQ(header).data("sticked")&&!0===a&&($PBJQ(header).data("sticked",!0),$PBJQ(".Mrphs-mainHeader").addClass("is-fixed")):($PBJQ(".Mrphs-mainHeader").removeClass("is-fixed"),$PBJQ(header).data("sticked",!1))});currentHeaderWidth=$PBJQ(".Mrphs-mainHeader").width();$PBJQ(".Mrphs-headerLogo").on("click",function(){document.body.scrollTop=0;document.body.scrollLeft=0;$PBJQ(window).trigger("scroll")});portal&&portal.user&&portal.user.impersonatorDisplayId&&$PBJQ("body").addClass("Mrphs-become-user-enabled")});
function f_scrollTop(){return f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function f_filterResults(a,b,c){a=a?a:0;b&&(!a||a>b)&&(a=b);return c&&(!a||a>c)?c:a}
$PBJQ(document).ready(function(){$PBJQ("input, textarea","#content").each(function(){$PBJQ(this).prop("disabled")&&$PBJQ(this).parent("label").addClass("disabled")});$PBJQ(document).keyup(function(a){27==a.keyCode&&($PBJQ("#selectSiteModal").hasClass("outscreen")||$PBJQ("#otherSitesMenu .otherSitesMenuClose").trigger("click"),$PBJQ(".Mrphs-directUrl__dropDown").each(function(){$PBJQ(this).hasClass("active")&&$PBJQ(this).find(".dropDown_close").trigger("click")}),$PBJQ(".fip-icon-up-dir").trigger("click"),
$PBJQ(".navigatePanelControls .close").trigger("click"))})});var MorpheusViewportHelper={isPhone:function(){return $PBJQ("#Mrphs-viewport-helpers .phone").is(":visible")},isTablet:function(){return $PBJQ("#Mrphs-viewport-helpers .tablet").is(":visible")},isDesktop:function(){return $PBJQ("#Mrphs-viewport-helpers .desktop").is(":visible")},isNonPhone:function(){return(this.isDesktop()||this.isTablet())&&!this.isPhone()}};