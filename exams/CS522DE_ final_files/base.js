import"./chunk-TUZVCNLT.js";import{a as Pe}from"./chunk-IVBC5U6I.js";import{a as gi}from"./chunk-3K2NBXOU.js";import"./chunk-4MVKLPWI.js";import{a as Ne,b as Oe}from"./chunk-AWADWZLW.js";import"./chunk-W7TE45IO.js";import{a as wt,d as tt}from"./chunk-4VLFYQ4P.js";import"./chunk-R46SCLF3.js";import{d as Ae}from"./chunk-VIX42KOB.js";import{a as Te}from"./chunk-QPXFJ53C.js";import{a as $t,e as D,f as N,h as Ie,i as Ce}from"./chunk-3B44UYHW.js";import"./chunk-PTOJFFWQ.js";import{b as De,c as ke}from"./chunk-BLPUKQJE.js";var $e=De((xe,Mt)=>{(function(n,t){typeof Mt=="object"&&Mt.exports?Mt.exports=t():n.EvEmitter=t()})(typeof window<"u"?window:xe,function(){function n(){}let t=n.prototype;return t.on=function(e,i){if(!e||!i)return this;let o=this._events=this._events||{},r=o[e]=o[e]||[];return r.includes(i)||r.push(i),this},t.once=function(e,i){if(!e||!i)return this;this.on(e,i);let o=this._onceEvents=this._onceEvents||{},r=o[e]=o[e]||{};return r[i]=!0,this},t.off=function(e,i){let o=this._events&&this._events[e];if(!o||!o.length)return this;let r=o.indexOf(i);return r!=-1&&o.splice(r,1),this},t.emitEvent=function(e,i){let o=this._events&&this._events[e];if(!o||!o.length)return this;o=o.slice(0),i=i||[];let r=this._onceEvents&&this._onceEvents[e];for(let a of o)r&&r[a]&&(this.off(e,a),delete r[a]),a.apply(this,i);return this},t.allOff=function(){return delete this._events,delete this._onceEvents,this},n})});var Ue=De((Me,Ut)=>{(function(n,t){typeof Ut=="object"&&Ut.exports?Ut.exports=t(n,$e()):n.imagesLoaded=t(n,n.EvEmitter)})(typeof window<"u"?window:Me,function(t,e){let i=t.jQuery,o=t.console;function r(s){return Array.isArray(s)?s:typeof s=="object"&&typeof s.length=="number"?[...s]:[s]}function a(s,f,g){if(!(this instanceof a))return new a(s,f,g);let m=s;if(typeof s=="string"&&(m=document.querySelectorAll(s)),!m){o.error(`Bad element for imagesLoaded ${m||s}`);return}this.elements=r(m),this.options={},typeof f=="function"?g=f:Object.assign(this.options,f),g&&this.on("always",g),this.getImages(),i&&(this.jqDeferred=new i.Deferred),setTimeout(this.check.bind(this))}a.prototype=Object.create(e.prototype),a.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)};let l=[1,9,11];a.prototype.addElementImages=function(s){s.nodeName==="IMG"&&this.addImage(s),this.options.background===!0&&this.addElementBackgroundImages(s);let{nodeType:f}=s;if(!f||!l.includes(f))return;let g=s.querySelectorAll("img");for(let m of g)this.addImage(m);if(typeof this.options.background=="string"){let m=s.querySelectorAll(this.options.background);for(let y of m)this.addElementBackgroundImages(y)}};let c=/url\((['"])?(.*?)\1\)/gi;a.prototype.addElementBackgroundImages=function(s){let f=getComputedStyle(s);if(!f)return;let g=c.exec(f.backgroundImage);for(;g!==null;){let m=g&&g[2];m&&this.addBackground(m,s),g=c.exec(f.backgroundImage)}},a.prototype.addImage=function(s){let f=new d(s);this.images.push(f)},a.prototype.addBackground=function(s,f){let g=new h(s,f);this.images.push(g)},a.prototype.check=function(){if(this.progressedCount=0,this.hasAnyBroken=!1,!this.images.length){this.complete();return}let s=(f,g,m)=>{setTimeout(()=>{this.progress(f,g,m)})};this.images.forEach(function(f){f.once("progress",s),f.check()})},a.prototype.progress=function(s,f,g){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!s.isLoaded,this.emitEvent("progress",[this,s,f]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,s),this.progressedCount===this.images.length&&this.complete(),this.options.debug&&o&&o.log(`progress: ${g}`,s,f)},a.prototype.complete=function(){let s=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(s,[this]),this.emitEvent("always",[this]),this.jqDeferred){let f=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[f](this)}};function d(s){this.img=s}d.prototype=Object.create(e.prototype),d.prototype.check=function(){if(this.getIsImageComplete()){this.confirm(this.img.naturalWidth!==0,"naturalWidth");return}this.proxyImage=new Image,this.img.crossOrigin&&(this.proxyImage.crossOrigin=this.img.crossOrigin),this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.currentSrc||this.img.src},d.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},d.prototype.confirm=function(s,f){this.isLoaded=s;let{parentNode:g}=this.img,m=g.nodeName==="PICTURE"?g:this.img;this.emitEvent("progress",[this,m,f])},d.prototype.handleEvent=function(s){let f="on"+s.type;this[f]&&this[f](s)},d.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},d.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},d.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)};function h(s,f){this.url=s,this.element=f,this.img=new Image}return h.prototype=Object.create(d.prototype),h.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(this.img.naturalWidth!==0,"naturalWidth"),this.unbindEvents())},h.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},h.prototype.confirm=function(s,f){this.isLoaded=s,this.emitEvent("progress",[this,this.element,f])},a.makeJQueryPlugin=function(s){s=s||t.jQuery,s&&(i=s,i.fn.imagesLoaded=function(f,g){return new a(this,f,g).jqDeferred.promise(i(this))})},a.makeJQueryPlugin(),a})});customElements.define("sakai-user-photo",Oe);var bn=ke(Ue());customElements.define("sakai-profile",Ne);var Le=ke(gi());var Lt=class extends $t{static properties={dialogTitle:{attribute:"dialog-title",type:String},_imageUrl:{state:!0},_uploadError:{state:!0},_removeError:{state:!0},_needsSave:{state:!0},_i18n:{state:!0}};constructor(){super(),this.loadTranslations("sakai-picture-changer").then(t=>this._i18n=t)}_attachCropper(){if(this.cropper)this.cropper.replace(this._imageUrl);else{let t=this.querySelector("#image");this.cropper=new Le.default(t,{autoCrop:!0,aspectRatio:1/1,checkCrossOrigin:!1,guides:!0,minContainerWidth:300,minContainerHeight:300,autoCropArea:1,viewMode:1,dragMode:"move",cropend:()=>this._needsSave=!0})}}firstUpdated(){let t=this.renderRoot.querySelector("#profile-image-upload");t&&t.addEventListener("show.bs.modal",()=>{this._loadExisting()})}_filePicked(t){t.target.files[0]&&(this.cropper.clear(),this.cropper.replace(URL.createObjectURL(t.target.files[0])),this._needsSave=!0)}_zoomIn(){this.cropper.zoom(.1),this._needsSave=!0}_zoomOut(){this.cropper.zoom(-.1),this._needsSave=!0}_up(){this.cropper.move(0,-10),this._needsSave=!0}_down(){this.cropper.move(0,10),this._needsSave=!0}_left(){this.cropper.move(10,0),this._needsSave=!0}_right(){this.cropper.move(-10,0),this._needsSave=!0}_rotate(){this.cropper.clear(),this.cropper.rotate(90),this.cropper.crop(),this._needsSave=!0}_refreshProfileImageTagsAndHideDialog(){let t=new Date,e=`/direct/profile/${wt()}/image?${t.getTime()}`;document.querySelectorAll(".sakai-accountProfileImage").forEach(r=>r.setAttribute("src",e));let i=`background-image: url(${e})`;document.querySelectorAll(`.sakai-user-photo[data-user-id='${wt()}']`).forEach(r=>{r.setAttribute("style",i)});let o=document.getElementById("myPhoto");o&&(o.src=e)}_loadExisting(){if(this._imageUrl)return;let t=`/direct/profile-image/details?_=${Date.now()}`;fetch(t,{credentials:"include"}).then(e=>e.json()).then(e=>{e.status=="SUCCESS"&&(e.isDefault||(this._imageUrl=`${e.url}?_=${Date.now()}`,this.updateComplete.then(()=>{this._attachCropper()}))),this.csrfToken=e.csrf_token})}_save(){let t=this.cropper.getCroppedCanvas().toDataURL().replace(/^data:image\/(png|jpg);base64,/,""),e=new URLSearchParams;e.append("base64",t);let i="/direct/profile-image/upload";fetch(i,{credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:e}).then(o=>{if(o.ok)return o.json();throw new Error(`Network error while uploading image at ${i}`)}).then(o=>{o.status=="SUCCESS"?(this._uploadError=!1,this._needsSave=!1,this._loadExisting(),this._refreshProfileImageTagsAndHideDialog()):this._uploadError=!0}).catch(o=>console.error(o))}_remove(){let t="/direct/profile-image/remove";fetch(t,{credentials:"include",headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({sakaiCsrfToken:this.csrfToken})}).then(e=>{if(e.ok)this._removeError=!1,this._needsSave=!1,this._loadExisting(),this._refreshProfileImageTagsAndHideDialog();else throw this._removeError=!0,new Error(`Network error while removing profile image at ${t}`)}).catch(e=>console.error(e))}shouldUpdate(){return this._i18n}render(){return D`

    <div class="modal fade" id="profile-image-upload" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5>${this.dialogTitle}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

        </div>
        <div class="modal-body">

            <div id="remove-error" class="sak-banner-error" style="display: ${this._removeError?"block":"none"}">${this._i18n.remove_error}</div>
            <div id="upload-error" class="sak-banner-error" style="display: ${this._uploadError?"block":"none"}">${this._i18n.upload_error}</div>

            <div id="image-editor-crop-wrapper">
              <div id="cropme">
                <input type="file" accept="image/*" value="Choose an image" @change=${this._filePicked} />
                <img id="image" src="${Te(this._imageUrl)}"/>

                <div id="image-editor-controls-wrapper">
                  <div id="controls">
                    <sakai-button @click=${this._zoomIn} type="small" title="${this._i18n.zoom_in}" arial-label="${this._i18n.zoom_in}">
                      <sakai-icon type="add"></sakai-icon>
                    </sakai-button>
                    <sakai-button @click=${this._zoomOut} type="small" title="${this._i18n.zoom_out}" arial-label="${this._i18n.zoom_out}">
                      <sakai-icon type="minus"></sakai-icon>
                    </sakai-button>
                    <sakai-button @click=${this._up} type="small" title="${this._i18n.pan_up}" arial-label="${this._i18n.pan_up}">
                      <sakai-icon type="up"></sakai-icon>
                    </sakai-button>
                    <sakai-button @click=${this._down} type="small" title="${this._i18n.pan_down}" arial-label="${this._i18n.pan_down}">
                      <sakai-icon type="down"></sakai-icon>
                    </sakai-button>
                    <sakai-button @click=${this._left} type="small" title="${this._i18n.pan_left}" arial-label="${this._i18n.pan_left}">
                      <sakai-icon type="left"></sakai-icon>
                    </sakai-button>
                    <sakai-button @click=${this._right} type="small" title="${this._i18n.pan_right}" arial-label="${this._i18n.pan_right}">
                      <sakai-icon type="right"></sakai-icon>
                    </sakai-button>
                    <sakai-button @click=${this._rotate} type="small" title="${this._i18n.rotate}" arial-label="${this._i18n.rotate}">
                      <sakai-icon type="refresh"></sakai-icon>
                    </sakai-button>
                  </div>
                </div>
              </div>
            </div>
        </div>
        <div class="modal-footer">
          <button class="btn float-start" data-bs-dismiss="modal" @click=${this._save} ?disabled=${!this._needsSave}>${this._i18n.save}</button>
          <button class="btn float-end" @click="${this._remove}">${this._i18n.remove}</button>
          <button class="btn float-start" data-bs-dismiss="modal">${this._i18n.cancel}</button>
        </div>
      </div>
    </div>
  </div>
    `}};customElements.define("sakai-picture-changer",Lt);var Ft="NOT_PUSH_CAPABLE",ie=new Map,oe="/sakai-service-worker.js",Fe=(n,t)=>{let e="/api/keys/sakaipush";console.debug(`Fetching the push key from ${e} ...`),fetch(e).then(i=>i.text()).then(i=>{n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i}).then(o=>{console.debug("Subscribed. Sending details to Sakai ...");let r={endpoint:o.endpoint,auth:o.toJSON().keys.auth,userKey:o.toJSON().keys.p256dh,browserFingerprint:Pe()},a="/api/users/me/pushEndpoint";fetch(a,{credentials:"include",method:"POST",body:new URLSearchParams(r)}).then(l=>{if(!l.ok)throw new Error(`Network error while posting push endpoint: ${a}`);console.debug("Subscription details sent successfully")}).catch(l=>console.error(l)).finally(()=>t("granted"))})})},ne=n=>(console.debug("subscribeIfPermitted"),document.body?.querySelectorAll(".portal-notifications-no-permissions-indicator").forEach(t=>t.classList.add("d-none")),document.body?.querySelectorAll(".portal-notifications-indicator").forEach(t=>t.classList.remove("d-none")),new Promise(t=>{if(Notification?.permission==="granted")console.debug("Permission already granted. Subscribing ..."),Fe(n,t);else if(Notification?.permission==="default"){console.debug("Push permission not set yet");try{Notification.requestPermission().then(e=>{e==="granted"?(console.debug("Permission granted. Subscribing ..."),Fe(n,t)):t(e)}).catch(e=>console.error(e))}catch(e){console.error(e)}}else t()})),mi=n=>{ie.get("notifications")?.forEach(e=>e(n.data))},Re=()=>{console.debug("setupServiceWorkerListener"),navigator.serviceWorker.addEventListener("message",mi)},vi=n=>{if(!n)return!1;let t=localStorage.getItem("last-sakai-user"),e=!t||t!==portal.user.id;return localStorage.setItem("last-sakai-user",n),e},Be=new Promise((n,t)=>{if(!navigator.serviceWorker||!window.Notification){t(Ft);return}navigator.serviceWorker.register(oe).then(e=>{if(!e.pushManager){t(Ft);return}e.active?(Re(),console.debug("Worker registered and setup"),n()):(console.debug("No active worker. Waiting for update ..."),e.addEventListener("updatefound",()=>{console.debug("Worker updated. Waiting for state change ..."),e.installing.addEventListener("statechange",r=>{console.debug("Worker state changed"),r.target.state==="activated"&&(console.debug("Worker activated. Setting up ..."),Re(),console.debug("Worker registered and setup"),n())})}))})}),He=async()=>{let n=await navigator.serviceWorker.register(oe);return ne(n)},We=(n,t)=>{console.debug(`Registering push callback for ${n}`);let e=ie.get(n)||[];e.push(t),ie.set(n,e)};vi(wt())&&(console.debug("The user has changed. Unsubscribing the previous user ..."),navigator.serviceWorker.register(oe).then(n=>{n.pushManager?.getSubscription().then(t=>{t?t.unsubscribe().finally(()=>{Notification?.permission==="granted"&&ne(n)}):Notification?.permission==="granted"&&ne(n)})}));var Et="NOTIFICATIONS",Rt="PUSH_DENIED_INFO",re="PUSH_INTO",ae="PUSH_SETUP_INFO";var Bt=class extends $t{static properties={url:{type:String},chromeInfoUrl:{attribute:"chrome-info-url",type:String},firefoxInfoUrl:{attribute:"firefox-info-url",type:String},safariInfoUrl:{attribute:"safari-info-url",type:String},edgeInfoUrl:{attribute:"edge-info-url",type:String},_state:{state:!0},_highlightTestButton:{state:!0},_i18n:{state:!0},_browserInfoUrl:{state:!0}};constructor(){super(),window.addEventListener("online",()=>this._online=!0),this.filteredNotifications=new Map,this._i18nLoaded=this.loadTranslations("sakai-notifications"),this._i18nLoaded.then(t=>this._i18n=t)}connectedCallback(){super.connectedCallback(),this._state=Et,this.chromeInfoUrl&&navigator.userAgent.includes("Chrome")&&!navigator.userAgent.includes("Edg")?this._browserInfoUrl=this.chromeInfoUrl:this.firefoxInfoUrl&&navigator.userAgent.includes("Firefox")?this._browserInfoUrl=this.firefoxInfoUrl:this.safariInfoUrl&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Edg")?this._browserInfoUrl=this.safariInfoUrl:this.safariInfoUrl&&navigator.userAgent.includes("Edg")&&(this._browserInfoUrl=this.edgeInfoUrl),this._i18nLoaded.then(()=>this._loadInitialNotifications())}clearTestNotifications(){this.notifications=[...this.notifications.filter(t=>!t.event.startsWith("test"))],this._filterIntoToolNotifications()}_loadInitialNotifications(t=!0){fetch(this.url,{credentials:"include",cache:"no-cache",headers:{"Content-Type":"application/json"}}).then(e=>{if(e.ok)return e.json();throw new Error(`Network error while retrieving notifications from ${this.url}`)}).then(e=>{this.notifications=e,this._filterIntoToolNotifications(),this._fireLoadedEvent(),t&&this._registerForNotifications()}).catch(e=>console.error(e))}_registerForNotifications(){console.debug("registerForNotifications"),Be.then(()=>{Notification.permission==="granted"&&We("notifications",t=>{this.notifications.unshift(t),this._fireLoadedEvent(),this._decorateNotification(t),this._filterIntoToolNotifications(!1)})}).catch(t=>{t===Ft&&(this._state=ae)})}_filterIntoToolNotifications(t=!0){this.filteredNotifications.clear(),this.notifications.forEach(i=>{t&&this._decorateNotification(i);let o=i.event.substring(0,i.event.indexOf("."));this.filteredNotifications.has(o)||this.filteredNotifications.set(o,[]),this.filteredNotifications.get(o).push(i)});let e=Array.from(this.filteredNotifications).sort(i=>i==="motd"?1:-1);this.filteredNotifications=new Map(e),this._state=Et,this.requestUpdate()}_decorateNotification(t){let e=t.event.substring(0,t.event.indexOf("."));e==="profile"?this._decorateProfileNotification(t):e==="asn"?this._decorateAssignmentNotification(t):e==="annc"?this._decorateAnnouncementNotification(t):e==="commons"?this._decorateCommonsNotification(t):e==="sam"?this._decorateSamigoNotification(t):e==="message"?this._decorateMessageNotification(t):e==="test"&&this._decorateTestNotification(t)}_decorateProfileNotification(t){switch(t.event){case"profile.friend.request":t.title=this._i18n.connection_request_received.replace("{0}",t.fromDisplayName);break;case"profile.friend.confirm":t.title=this._i18n.connection_request_accepted.replace("{0}",t.fromDisplayName);break;case"profile.message.sent":t.title=this._i18n.message_received.replace("{0}",t.fromDisplayName);break;default:}}_decorateAssignmentNotification(t){t.event==="asn.new.assignment"||t.event==="asn.revise.access"?t.title=this._i18n.assignment_created.replace("{0}",t.title).replace("{1}",t.siteTitle):t.event==="asn.grade.submission"&&(t.title=this._i18n.assignment_submission_graded.replace("{0}",t.title).replace("{1}",t.siteTitle))}_decorateAnnouncementNotification(t){(t.event==="annc.new"||t.event==="annc.available.announcement")&&(t.title=this._i18n.announcement.replace("{0}",t.title).replace("{1}",t.siteTitle))}_decorateCommonsNotification(t){t.title=this._i18n.academic_comment_graded.replace("{0}",t.siteTitle)}_decorateSamigoNotification(t){(t.event==="sam.assessment.available"||t.event==="sam.assessment.update.available")&&(t.title=this._i18n.samigoCreated.replace("{0}",t.title).replace("{1}",t.siteTitle))}_decorateTestNotification(t){t.body=this._i18n.test_notification_body.replace("{0}",tt()),t.bodyShowing=!0}_fireLoadedEvent(){let t=this.notifications.filter(e=>!e.viewed).length;this.dispatchEvent(new CustomEvent("notifications-loaded",{detail:{count:t},bubbles:!0})),navigator.setAppBadge&&navigator.setAppBadge(t)}_clearNotification(t){let e=t.target.dataset.notificationId,i=`/api/users/me/notifications/${e}/clear`;fetch(i,{method:"POST",credentials:"include"}).then(o=>{if(o.ok){let r=this.notifications.findIndex(a=>a.id==e);this.notifications.splice(r,1),this._fireLoadedEvent(),this._filterIntoToolNotifications(!1)}else throw new Error(`Network error while clearing notification at ${i}`)}).catch(o=>console.error(o))}_clearAllNotifications(){let t="/api/users/me/notifications/clear";fetch(t,{method:"POST",credentials:"include"}).then(e=>{if(e.ok)this.notifications=[],this._fireLoadedEvent(),this._filterIntoToolNotifications();else throw new Error(`Network error while clearing all notifications at ${t}`)}).catch(e=>console.error(e))}_markAllNotificationsViewed(){let t="/api/users/me/notifications/markViewed";fetch(t,{method:"POST",credentials:"include"}).then(e=>{if(e.ok)this.notifications?.forEach(i=>i.viewed=!0),this.requestUpdate(),this._fireLoadedEvent();else throw new Error(`Network error while marking all notifications viewed at ${t}`)}).catch(e=>console.error(e))}_viewMotd(t){let e=this.filteredNotifications.get(t.target.dataset.prefix).find(i=>i.ref===t.target.dataset.ref);if(e?.body)e.bodyShowing=!e.bodyShowing,this.requestUpdate();else{let i=`/direct${t.target.dataset.ref}.json`;fetch(i).then(o=>{if(o.ok)return o.json();throw new Error(`Network error while retrieving MOTD from ${i}`)}).then(o=>{e.body=o.body,e.bodyShowing=!0,this.requestUpdate()}).catch(o=>console.error(o))}}_triggerPushSubscription(){He().then(t=>{switch(t){case"denied":this._state=Rt;break;case"granted":this._loadInitialNotifications(!0),this._highlightTestButton=!0;break}})}_showNotifications(){this._state=Et}_enablePush(){Notification.permission==="denied"?this._state=Rt:this._state=re}_sendTestNotification(){this._highlightTestButton=!1;let t="/api/users/me/notifications/test";fetch(t,{method:"POST"}).then(e=>{if(!e.ok)throw Error(`Network error while sending test notification at ${t}`)}).catch(e=>console.error(e))}shouldUpdate(){return this._i18n}_renderAccordion(t,e){return D`
      <div class="accordion-item rounded-1 mb-2">
        <h2 class="accordion-header mt-0 fs-2">
          <button class="accordion-button ${t==="test"?"":"collapsed"}"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#${t}-accordion"
              aria-expanded="false"
              aria-controls="${t}-accordion">
            ${this._i18n[t]}<span class="badge bg-secondary ms-2">${e.length}</span>
          </button>
        </h2>
        <div id="${t}-accordion" class="accordion-collapse collapse ${t==="test"?"show":""}">
          <div class="accordion-body px-0 py-1 rounded-0">
            <ul class="list-unstyled d-flex flex-column align-items-center py-2">
              ${e.map(i=>D`
              <li class="toast fade show mt-2 shadow-sm">
                <div class="toast-header">
                  <sakai-user-photo user-id="${i.fromUser}" classes="mh-100 me-2" profile-popup="on"></sakai-user-photo>
                  <strong class="me-auto">${i.fromDisplayName}</strong>
                  <small>${i.formattedEventDate}</small>
                  ${t!=="test"?D`
                    <button type="button"
                        class="btn-close"
                        aria-label="${this._i18n.clear_this_notification}"
                        data-notification-id="${i.id}"
                        @click=${this._clearNotification}>
                    </button>
                  `:N}
                </div>
                <div class="toast-body">
                  <div class="d-flex justify-content-between">
                    <div>${i.title}</div>
                    <div>
                      ${t!=="motd"&&t!=="test"?D`
                        <a href="${i.url}">
                          <i class="si si-sakai-filled-right-arrow"></i>
                        </a>
                      `:N}
                      ${t==="motd"?D`
                        <button type="button"
                            data-ref="${i.ref}"
                            data-prefix="${t}"
                            class="btn btn-link"
                            @click=${this._viewMotd}>
                          ${i.bodyShowing?this._i18n.hide:this._i18n.show}
                        </button>
                      `:N}
                    </div>
                  </div>
                  ${i.bodyShowing?D`
                    <div class="mt-3">${Ae(i.body)}</div>
                  `:N}
                </div>
              </li>
              `)}
            </ul>
          </div>
        </div>
      </div>
    `}render(){return D`
      ${this._state===ae?D`
        <div class="sak-banner-warn justify-content-around">
          <div class="fw-bold">${this._i18n.push_setup_failure_info}</div>
          <ol class="mt-2">
            <li>${this._i18n.push_setup_failure_info_1.replace("{0}",tt())}</li>
            <li>${this._i18n.push_setup_failure_info_2}</li>
            <li>${this._i18n.push_setup_failure_info_3}</li>
          </ol>
          <div class="fw-bold">${this._i18n.push_setup_failure_info_4.replaceAll("{}",tt())}</div>
        </div>
      `:N}

      ${this._state===Rt?D`
        <div class="sak-banner-error justify-content-around">
          <div class="mb-3">${this._i18n.notifications_denied.replace("{0}",tt())}</div>
          <div>${this._i18n.notifications_not_allowed2.replace("{0}",tt())}</div>
          ${this._browserInfoUrl?D`
          <div class="mt-3">
            <a href="${this._browserInfoUrl}" class="fw-bold" target="_blank">${this._i18n.browser_info_link_text}</a>
          </div>
          `:N}
        </div>
        <div class="text-center">
          <button @click=${this._showNotifications} class="btn btn-primary mt-4">${this._i18n.show_notifications}</button>
        </div>
      `:N}

      ${this._state===re?D`
        <div class="sak-banner-info justify-content-around">
          <div>
            <div class="mb-1">${this._i18n.notifications_not_allowed.replace("{0}",tt())}</div>
            <div class="fw-bold">${this._i18n.notifications_not_allowed2.replace("{0}",tt())}</div>
          </div>
        </div>
        <div class="text-center">
          <button @click=${this._triggerPushSubscription} class="btn btn-primary mt-4">${this._i18n.accept_notifications}</button>
        </div>
      `:N}

      ${this._state===Et?D`
        ${Notification.permission!=="granted"&&this._online?D`
          <div class="alert alert-warning">
            <span class="me-1">${this._i18n.push_not_enabled}</span>
            <button type="button"
                class="btn btn-secondary btn-sm"
                aria-label="${this._i18n_enable_push_label}"
                @click=${this._enablePush}>
              ${this._i18n.enable_push}
            </button>
          </div>
        `:N}

        <div class="accordion py-0">
          ${Array.from(this.filteredNotifications,t=>t[0]).map(t=>D`
            ${this._renderAccordion(t,this.filteredNotifications.get(t))}
          `)}
        </div>

        ${this.notifications?.length?N:D`
          <div class="d-flex justify-content-around">
            <div><strong>${this._i18n.no_notifications}</strong></div>
          </div>
        `}

        <div class="d-flex justify-content-between my-2">
          ${this._online&&Notification.permission==="granted"?D`
            <div>
              <button class="btn ${this._highlightTestButton?"btn-primary":"btn-secondary"} btn-sm"
                  @click=${this._sendTestNotification}>
                ${this._i18n.test}
              </button>
            </div>
          `:N}

          <div class="ms-auto text-end">

            ${Notification.permission!=="granted"&&this._online?D`
              <button class="btn btn-secondary btn-sm me-2"
                  @click=${this._loadInitialNotifications}>
                ${this._i18n.update}
              </button>
            `:N}

            ${this._online&&this.notifications?.filter(t=>!t.viewed).length>0?D`
              <button class="btn btn-secondary btn-sm"
                  @click=${this._markAllNotificationsViewed}>
                ${this._i18n.mark_all_viewed}
              </button>
            `:N}
            ${this._online&&this.notifications?.length?D`
              <button id="sakai-notifications-clear-all-button"
                  class="btn btn-secondary btn-sm"
                  @click=${this._clearAllNotifications}>
                ${this._i18n.clear_all}
              </button>
            `:N}
          </div>
        </div>
      `:N}
    `}};customElements.define("sakai-notifications",Bt);function je(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),e.push.apply(e,i)}return e}function Y(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?je(Object(e),!0).forEach(function(i){bi(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):je(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function Xt(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Xt=function(t){return typeof t}:Xt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xt(n)}function bi(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function V(){return V=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},V.apply(this,arguments)}function _i(n,t){if(n==null)return{};var e={},i=Object.keys(n),o,r;for(r=0;r<i.length;r++)o=i[r],!(t.indexOf(o)>=0)&&(e[o]=n[o]);return e}function yi(n,t){if(n==null)return{};var e=_i(n,t),i,o;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(o=0;o<r.length;o++)i=r[o],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(e[i]=n[i])}return e}var wi="1.15.1";function K(n){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(n)}var J=K(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),At=K(/Edge/i),qe=K(/firefox/i),It=K(/safari/i)&&!K(/chrome/i)&&!K(/android/i),Qe=K(/iP(ad|od|hone)/i),Ze=K(/chrome/i)&&K(/android/i),ti={capture:!1,passive:!1};function w(n,t,e){n.addEventListener(t,e,!J&&ti)}function _(n,t,e){n.removeEventListener(t,e,!J&&ti)}function Vt(n,t){if(t){if(t[0]===">"&&(t=t.substring(1)),n)try{if(n.matches)return n.matches(t);if(n.msMatchesSelector)return n.msMatchesSelector(t);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(t)}catch{return!1}return!1}}function Ei(n){return n.host&&n!==document&&n.host.nodeType?n.host:n.parentNode}function q(n,t,e,i){if(n){e=e||document;do{if(t!=null&&(t[0]===">"?n.parentNode===e&&Vt(n,t):Vt(n,t))||i&&n===e)return n;if(n===e)break}while(n=Ei(n))}return null}var Xe=/\s+/g;function U(n,t,e){if(n&&t)if(n.classList)n.classList[e?"add":"remove"](t);else{var i=(" "+n.className+" ").replace(Xe," ").replace(" "+t+" "," ");n.className=(i+(e?" "+t:"")).replace(Xe," ")}}function p(n,t,e){var i=n&&n.style;if(i){if(e===void 0)return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle(n,""):n.currentStyle&&(e=n.currentStyle),t===void 0?e:e[t];!(t in i)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),i[t]=e+(typeof e=="string"?"":"px")}}function pt(n,t){var e="";if(typeof n=="string")e=n;else do{var i=p(n,"transform");i&&i!=="none"&&(e=i+" "+e)}while(!t&&(n=n.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(e)}function ei(n,t,e){if(n){var i=n.getElementsByTagName(t),o=0,r=i.length;if(e)for(;o<r;o++)e(i[o],o);return i}return[]}function X(){var n=document.scrollingElement;return n||document.documentElement}function C(n,t,e,i,o){if(!(!n.getBoundingClientRect&&n!==window)){var r,a,l,c,d,h,s;if(n!==window&&n.parentNode&&n!==X()?(r=n.getBoundingClientRect(),a=r.top,l=r.left,c=r.bottom,d=r.right,h=r.height,s=r.width):(a=0,l=0,c=window.innerHeight,d=window.innerWidth,h=window.innerHeight,s=window.innerWidth),(t||e)&&n!==window&&(o=o||n.parentNode,!J))do if(o&&o.getBoundingClientRect&&(p(o,"transform")!=="none"||e&&p(o,"position")!=="static")){var f=o.getBoundingClientRect();a-=f.top+parseInt(p(o,"border-top-width")),l-=f.left+parseInt(p(o,"border-left-width")),c=a+r.height,d=l+r.width;break}while(o=o.parentNode);if(i&&n!==window){var g=pt(o||n),m=g&&g.a,y=g&&g.d;g&&(a/=y,l/=m,s/=m,h/=y,c=a+h,d=l+s)}return{top:a,left:l,bottom:c,right:d,width:s,height:h}}}function ii(n){var t=C(n),e=parseInt(p(n,"padding-left")),i=parseInt(p(n,"padding-top")),o=parseInt(p(n,"padding-right")),r=parseInt(p(n,"padding-bottom"));return t.top+=i+parseInt(p(n,"border-top-width")),t.left+=e+parseInt(p(n,"border-left-width")),t.width=n.clientWidth-e-o,t.height=n.clientHeight-i-r,t.bottom=t.top+t.height,t.right=t.left+t.width,t}function Ye(n,t,e){for(var i=nt(n,!0),o=C(n)[t];i;){var r=C(i)[e],a=void 0;if(e==="top"||e==="left"?a=o>=r:a=o<=r,!a)return i;if(i===X())break;i=nt(i,!1)}return!1}function gt(n,t,e,i){for(var o=0,r=0,a=n.children;r<a.length;){if(a[r].style.display!=="none"&&a[r]!==v.ghost&&(i||a[r]!==v.dragged)&&q(a[r],e.draggable,n,!1)){if(o===t)return a[r];o++}r++}return null}function ye(n,t){for(var e=n.lastElementChild;e&&(e===v.ghost||p(e,"display")==="none"||t&&!Vt(e,t));)e=e.previousElementSibling;return e||null}function R(n,t){var e=0;if(!n||!n.parentNode)return-1;for(;n=n.previousElementSibling;)n.nodeName.toUpperCase()!=="TEMPLATE"&&n!==v.clone&&(!t||Vt(n,t))&&e++;return e}function Ge(n){var t=0,e=0,i=X();if(n)do{var o=pt(n),r=o.a,a=o.d;t+=n.scrollLeft*r,e+=n.scrollTop*a}while(n!==i&&(n=n.parentNode));return[t,e]}function Si(n,t){for(var e in n)if(n.hasOwnProperty(e)){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===n[e][i])return Number(e)}return-1}function nt(n,t){if(!n||!n.getBoundingClientRect)return X();var e=n,i=!1;do if(e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight){var o=p(e);if(e.clientWidth<e.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||e.clientHeight<e.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!e.getBoundingClientRect||e===document.body)return X();if(i||t)return e;i=!0}}while(e=e.parentNode);return X()}function Di(n,t){if(n&&t)for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function se(n,t){return Math.round(n.top)===Math.round(t.top)&&Math.round(n.left)===Math.round(t.left)&&Math.round(n.height)===Math.round(t.height)&&Math.round(n.width)===Math.round(t.width)}var Ct;function ni(n,t){return function(){if(!Ct){var e=arguments,i=this;e.length===1?n.call(i,e[0]):n.apply(i,e),Ct=setTimeout(function(){Ct=void 0},t)}}}function ki(){clearTimeout(Ct),Ct=void 0}function oi(n,t,e){n.scrollLeft+=t,n.scrollTop+=e}function ri(n){var t=window.Polymer,e=window.jQuery||window.Zepto;return t&&t.dom?t.dom(n).cloneNode(!0):e?e(n).clone(!0)[0]:n.cloneNode(!0)}var F="Sortable"+new Date().getTime();function Ii(){var n=[],t;return{captureAnimationState:function(){if(n=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(o){if(!(p(o,"display")==="none"||o===v.ghost)){n.push({target:o,rect:C(o)});var r=Y({},n[n.length-1].rect);if(o.thisAnimationDuration){var a=pt(o,!0);a&&(r.top-=a.f,r.left-=a.e)}o.fromRect=r}})}},addAnimationState:function(i){n.push(i)},removeAnimationState:function(i){n.splice(Si(n,{target:i}),1)},animateAll:function(i){var o=this;if(!this.options.animation){clearTimeout(t),typeof i=="function"&&i();return}var r=!1,a=0;n.forEach(function(l){var c=0,d=l.target,h=d.fromRect,s=C(d),f=d.prevFromRect,g=d.prevToRect,m=l.rect,y=pt(d,!0);y&&(s.top-=y.f,s.left-=y.e),d.toRect=s,d.thisAnimationDuration&&se(f,s)&&!se(h,s)&&(m.top-s.top)/(m.left-s.left)===(h.top-s.top)/(h.left-s.left)&&(c=Ti(m,f,g,o.options)),se(s,h)||(d.prevFromRect=h,d.prevToRect=s,c||(c=o.options.animation),o.animate(d,m,s,c)),c&&(r=!0,a=Math.max(a,c),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},c),d.thisAnimationDuration=c)}),clearTimeout(t),r?t=setTimeout(function(){typeof i=="function"&&i()},a):typeof i=="function"&&i(),n=[]},animate:function(i,o,r,a){if(a){p(i,"transition",""),p(i,"transform","");var l=pt(this.el),c=l&&l.a,d=l&&l.d,h=(o.left-r.left)/(c||1),s=(o.top-r.top)/(d||1);i.animatingX=!!h,i.animatingY=!!s,p(i,"transform","translate3d("+h+"px,"+s+"px,0)"),this.forRepaintDummy=Ci(i),p(i,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),p(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){p(i,"transition",""),p(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},a)}}}}function Ci(n){return n.offsetWidth}function Ti(n,t,e,i){return Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))/Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))*i.animation}var dt=[],le={initializeByDefault:!0},Pt={mount:function(t){for(var e in le)le.hasOwnProperty(e)&&!(e in t)&&(t[e]=le[e]);dt.forEach(function(i){if(i.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),dt.push(t)},pluginEvent:function(t,e,i){var o=this;this.eventCanceled=!1,i.cancel=function(){o.eventCanceled=!0};var r=t+"Global";dt.forEach(function(a){e[a.pluginName]&&(e[a.pluginName][r]&&e[a.pluginName][r](Y({sortable:e},i)),e.options[a.pluginName]&&e[a.pluginName][t]&&e[a.pluginName][t](Y({sortable:e},i)))})},initializePlugins:function(t,e,i,o){dt.forEach(function(l){var c=l.pluginName;if(!(!t.options[c]&&!l.initializeByDefault)){var d=new l(t,e,t.options);d.sortable=t,d.options=t.options,t[c]=d,V(i,d.defaults)}});for(var r in t.options)if(t.options.hasOwnProperty(r)){var a=this.modifyOption(t,r,t.options[r]);typeof a<"u"&&(t.options[r]=a)}},getEventProperties:function(t,e){var i={};return dt.forEach(function(o){typeof o.eventProperties=="function"&&V(i,o.eventProperties.call(e[o.pluginName],t))}),i},modifyOption:function(t,e,i){var o;return dt.forEach(function(r){t[r.pluginName]&&r.optionListeners&&typeof r.optionListeners[e]=="function"&&(o=r.optionListeners[e].call(t[r.pluginName],i))}),o}};function Ni(n){var t=n.sortable,e=n.rootEl,i=n.name,o=n.targetEl,r=n.cloneEl,a=n.toEl,l=n.fromEl,c=n.oldIndex,d=n.newIndex,h=n.oldDraggableIndex,s=n.newDraggableIndex,f=n.originalEvent,g=n.putSortable,m=n.extraEventProperties;if(t=t||e&&e[F],!!t){var y,B=t.options,G="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!J&&!At?y=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(y=document.createEvent("Event"),y.initEvent(i,!0,!0)),y.to=a||e,y.from=l||e,y.item=o||e,y.clone=r,y.oldIndex=c,y.newIndex=d,y.oldDraggableIndex=h,y.newDraggableIndex=s,y.originalEvent=f,y.pullMode=g?g.lastPutMode:void 0;var A=Y(Y({},m),Pt.getEventProperties(i,t));for(var H in A)y[H]=A[H];e&&e.dispatchEvent(y),B[G]&&B[G].call(t,y)}}var Oi=["evt"],x=function(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=i.evt,r=yi(i,Oi);Pt.pluginEvent.bind(v)(t,e,Y({dragEl:u,parentEl:k,ghostEl:b,rootEl:E,nextEl:ct,lastDownEl:Yt,cloneEl:S,cloneHidden:it,dragStarted:St,putSortable:T,activeSortable:v.active,originalEvent:o,oldIndex:ht,oldDraggableIndex:Tt,newIndex:L,newDraggableIndex:et,hideGhostForTarget:ci,unhideGhostForTarget:di,cloneNowHidden:function(){it=!0},cloneNowShown:function(){it=!1},dispatchSortableEvent:function(l){P({sortable:e,name:l,originalEvent:o})}},r))};function P(n){Ni(Y({putSortable:T,cloneEl:S,targetEl:u,rootEl:E,oldIndex:ht,oldDraggableIndex:Tt,newIndex:L,newDraggableIndex:et},n))}var u,k,b,E,ct,Yt,S,it,ht,L,Tt,et,Ht,T,ft=!1,Jt=!1,Qt=[],st,W,ce,de,ze,Ke,St,ut,Nt,Ot=!1,Wt=!1,Gt,O,ue=[],me=!1,Zt=[],ee=typeof document<"u",jt=Qe,Ve=At||J?"cssFloat":"float",Ai=ee&&!Ze&&!Qe&&"draggable"in document.createElement("div"),ai=function(){if(ee){if(J)return!1;var n=document.createElement("x");return n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"}}(),si=function(t,e){var i=p(t),o=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),r=gt(t,0,e),a=gt(t,1,e),l=r&&p(r),c=a&&p(a),d=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+C(r).width,h=c&&parseInt(c.marginLeft)+parseInt(c.marginRight)+C(a).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(r&&l.float&&l.float!=="none"){var s=l.float==="left"?"left":"right";return a&&(c.clear==="both"||c.clear===s)?"vertical":"horizontal"}return r&&(l.display==="block"||l.display==="flex"||l.display==="table"||l.display==="grid"||d>=o&&i[Ve]==="none"||a&&i[Ve]==="none"&&d+h>o)?"vertical":"horizontal"},Pi=function(t,e,i){var o=i?t.left:t.top,r=i?t.right:t.bottom,a=i?t.width:t.height,l=i?e.left:e.top,c=i?e.right:e.bottom,d=i?e.width:e.height;return o===l||r===c||o+a/2===l+d/2},xi=function(t,e){var i;return Qt.some(function(o){var r=o[F].options.emptyInsertThreshold;if(!(!r||ye(o))){var a=C(o),l=t>=a.left-r&&t<=a.right+r,c=e>=a.top-r&&e<=a.bottom+r;if(l&&c)return i=o}}),i},li=function(t){function e(r,a){return function(l,c,d,h){var s=l.options.group.name&&c.options.group.name&&l.options.group.name===c.options.group.name;if(r==null&&(a||s))return!0;if(r==null||r===!1)return!1;if(a&&r==="clone")return r;if(typeof r=="function")return e(r(l,c,d,h),a)(l,c,d,h);var f=(a?l:c).options.group.name;return r===!0||typeof r=="string"&&r===f||r.join&&r.indexOf(f)>-1}}var i={},o=t.group;(!o||Xt(o)!="object")&&(o={name:o}),i.name=o.name,i.checkPull=e(o.pull,!0),i.checkPut=e(o.put),i.revertClone=o.revertClone,t.group=i},ci=function(){!ai&&b&&p(b,"display","none")},di=function(){!ai&&b&&p(b,"display","")};ee&&!Ze&&document.addEventListener("click",function(n){if(Jt)return n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),Jt=!1,!1},!0);var lt=function(t){if(u){t=t.touches?t.touches[0]:t;var e=xi(t.clientX,t.clientY);if(e){var i={};for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o]);i.target=i.rootEl=e,i.preventDefault=void 0,i.stopPropagation=void 0,e[F]._onDragOver(i)}}},$i=function(t){u&&u.parentNode[F]._isOutsideThisEl(t.target)};function v(n,t){if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(n));this.el=n,this.options=t=V({},t),n[F]=this;var e={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(n.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return si(n,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(a,l){a.setData("Text",l.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:v.supportPointer!==!1&&"PointerEvent"in window&&!It,emptyInsertThreshold:5};Pt.initializePlugins(this,n,e);for(var i in e)!(i in t)&&(t[i]=e[i]);li(t);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=t.forceFallback?!1:Ai,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?w(n,"pointerdown",this._onTapStart):(w(n,"mousedown",this._onTapStart),w(n,"touchstart",this._onTapStart)),this.nativeDraggable&&(w(n,"dragover",this),w(n,"dragenter",this)),Qt.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),V(this,Ii())}v.prototype={constructor:v,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(ut=null)},_getDirection:function(t,e){return typeof this.options.direction=="function"?this.options.direction.call(this,t,e,u):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,i=this.el,o=this.options,r=o.preventOnFilter,a=t.type,l=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,c=(l||t).target,d=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||c,h=o.filter;if(Wi(i),!u&&!(/mousedown|pointerdown/.test(a)&&t.button!==0||o.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&It&&c&&c.tagName.toUpperCase()==="SELECT")&&(c=q(c,o.draggable,i,!1),!(c&&c.animated)&&Yt!==c)){if(ht=R(c),Tt=R(c,o.draggable),typeof h=="function"){if(h.call(this,t,c,this)){P({sortable:e,rootEl:d,name:"filter",targetEl:c,toEl:i,fromEl:i}),x("filter",e,{evt:t}),r&&t.cancelable&&t.preventDefault();return}}else if(h&&(h=h.split(",").some(function(s){if(s=q(d,s.trim(),i,!1),s)return P({sortable:e,rootEl:s,name:"filter",targetEl:c,fromEl:i,toEl:i}),x("filter",e,{evt:t}),!0}),h)){r&&t.cancelable&&t.preventDefault();return}o.handle&&!q(d,o.handle,i,!1)||this._prepareDragStart(t,l,c)}}},_prepareDragStart:function(t,e,i){var o=this,r=o.el,a=o.options,l=r.ownerDocument,c;if(i&&!u&&i.parentNode===r){var d=C(i);if(E=r,u=i,k=u.parentNode,ct=u.nextSibling,Yt=i,Ht=a.group,v.dragged=u,st={target:u,clientX:(e||t).clientX,clientY:(e||t).clientY},ze=st.clientX-d.left,Ke=st.clientY-d.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,u.style["will-change"]="all",c=function(){if(x("delayEnded",o,{evt:t}),v.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!qe&&o.nativeDraggable&&(u.draggable=!0),o._triggerDragStart(t,e),P({sortable:o,name:"choose",originalEvent:t}),U(u,a.chosenClass,!0)},a.ignore.split(",").forEach(function(h){ei(u,h.trim(),fe)}),w(l,"dragover",lt),w(l,"mousemove",lt),w(l,"touchmove",lt),w(l,"mouseup",o._onDrop),w(l,"touchend",o._onDrop),w(l,"touchcancel",o._onDrop),qe&&this.nativeDraggable&&(this.options.touchStartThreshold=4,u.draggable=!0),x("delayStart",this,{evt:t}),a.delay&&(!a.delayOnTouchOnly||e)&&(!this.nativeDraggable||!(At||J))){if(v.eventCanceled){this._onDrop();return}w(l,"mouseup",o._disableDelayedDrag),w(l,"touchend",o._disableDelayedDrag),w(l,"touchcancel",o._disableDelayedDrag),w(l,"mousemove",o._delayedDragTouchMoveHandler),w(l,"touchmove",o._delayedDragTouchMoveHandler),a.supportPointer&&w(l,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(c,a.delay)}else c()}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){u&&fe(u),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;_(t,"mouseup",this._disableDelayedDrag),_(t,"touchend",this._disableDelayedDrag),_(t,"touchcancel",this._disableDelayedDrag),_(t,"mousemove",this._delayedDragTouchMoveHandler),_(t,"touchmove",this._delayedDragTouchMoveHandler),_(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||t.pointerType=="touch"&&t,!this.nativeDraggable||e?this.options.supportPointer?w(document,"pointermove",this._onTouchMove):e?w(document,"touchmove",this._onTouchMove):w(document,"mousemove",this._onTouchMove):(w(u,"dragend",this),w(E,"dragstart",this._onDragStart));try{document.selection?zt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,e){if(ft=!1,E&&u){x("dragStarted",this,{evt:e}),this.nativeDraggable&&w(document,"dragover",$i);var i=this.options;!t&&U(u,i.dragClass,!1),U(u,i.ghostClass,!0),v.active=this,t&&this._appendGhost(),P({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(W){this._lastX=W.clientX,this._lastY=W.clientY,ci();for(var t=document.elementFromPoint(W.clientX,W.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(W.clientX,W.clientY),t!==e);)e=t;if(u.parentNode[F]._isOutsideThisEl(t),e)do{if(e[F]){var i=void 0;if(i=e[F]._onDragOver({clientX:W.clientX,clientY:W.clientY,target:t,rootEl:e}),i&&!this.options.dragoverBubble)break}t=e}while(e=e.parentNode);di()}},_onTouchMove:function(t){if(st){var e=this.options,i=e.fallbackTolerance,o=e.fallbackOffset,r=t.touches?t.touches[0]:t,a=b&&pt(b,!0),l=b&&a&&a.a,c=b&&a&&a.d,d=jt&&O&&Ge(O),h=(r.clientX-st.clientX+o.x)/(l||1)+(d?d[0]-ue[0]:0)/(l||1),s=(r.clientY-st.clientY+o.y)/(c||1)+(d?d[1]-ue[1]:0)/(c||1);if(!v.active&&!ft){if(i&&Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(b){a?(a.e+=h-(ce||0),a.f+=s-(de||0)):a={a:1,b:0,c:0,d:1,e:h,f:s};var f="matrix(".concat(a.a,",").concat(a.b,",").concat(a.c,",").concat(a.d,",").concat(a.e,",").concat(a.f,")");p(b,"webkitTransform",f),p(b,"mozTransform",f),p(b,"msTransform",f),p(b,"transform",f),ce=h,de=s,W=r}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!b){var t=this.options.fallbackOnBody?document.body:E,e=C(u,!0,jt,!0,t),i=this.options;if(jt){for(O=t;p(O,"position")==="static"&&p(O,"transform")==="none"&&O!==document;)O=O.parentNode;O!==document.body&&O!==document.documentElement?(O===document&&(O=X()),e.top+=O.scrollTop,e.left+=O.scrollLeft):O=X(),ue=Ge(O)}b=u.cloneNode(!0),U(b,i.ghostClass,!1),U(b,i.fallbackClass,!0),U(b,i.dragClass,!0),p(b,"transition",""),p(b,"transform",""),p(b,"box-sizing","border-box"),p(b,"margin",0),p(b,"top",e.top),p(b,"left",e.left),p(b,"width",e.width),p(b,"height",e.height),p(b,"opacity","0.8"),p(b,"position",jt?"absolute":"fixed"),p(b,"zIndex","100000"),p(b,"pointerEvents","none"),v.ghost=b,t.appendChild(b),p(b,"transform-origin",ze/parseInt(b.style.width)*100+"% "+Ke/parseInt(b.style.height)*100+"%")}},_onDragStart:function(t,e){var i=this,o=t.dataTransfer,r=i.options;if(x("dragStart",this,{evt:t}),v.eventCanceled){this._onDrop();return}x("setupClone",this),v.eventCanceled||(S=ri(u),S.removeAttribute("id"),S.draggable=!1,S.style["will-change"]="",this._hideClone(),U(S,this.options.chosenClass,!1),v.clone=S),i.cloneId=zt(function(){x("clone",i),!v.eventCanceled&&(i.options.removeCloneOnHide||E.insertBefore(S,u),i._hideClone(),P({sortable:i,name:"clone"}))}),!e&&U(u,r.dragClass,!0),e?(Jt=!0,i._loopId=setInterval(i._emulateDragOver,50)):(_(document,"mouseup",i._onDrop),_(document,"touchend",i._onDrop),_(document,"touchcancel",i._onDrop),o&&(o.effectAllowed="move",r.setData&&r.setData.call(i,o,u)),w(document,"drop",i),p(u,"transform","translateZ(0)")),ft=!0,i._dragStartId=zt(i._dragStarted.bind(i,e,t)),w(document,"selectstart",i),St=!0,It&&p(document.body,"user-select","none")},_onDragOver:function(t){var e=this.el,i=t.target,o,r,a,l=this.options,c=l.group,d=v.active,h=Ht===c,s=l.sort,f=T||d,g,m=this,y=!1;if(me)return;function B(yt,hi){x(yt,m,Y({evt:t,isOwner:h,axis:g?"vertical":"horizontal",revert:a,dragRect:o,targetRect:r,canSort:s,fromSortable:f,target:i,completed:A,onMove:function(Se,pi){return qt(E,e,u,o,Se,C(Se),t,pi)},changed:H},hi))}function G(){B("dragOverAnimationCapture"),m.captureAnimationState(),m!==f&&f.captureAnimationState()}function A(yt){return B("dragOverCompleted",{insertion:yt}),yt&&(h?d._hideClone():d._showClone(m),m!==f&&(U(u,T?T.options.ghostClass:d.options.ghostClass,!1),U(u,l.ghostClass,!0)),T!==m&&m!==v.active?T=m:m===v.active&&T&&(T=null),f===m&&(m._ignoreWhileAnimating=i),m.animateAll(function(){B("dragOverAnimationComplete"),m._ignoreWhileAnimating=null}),m!==f&&(f.animateAll(),f._ignoreWhileAnimating=null)),(i===u&&!u.animated||i===e&&!i.animated)&&(ut=null),!l.dragoverBubble&&!t.rootEl&&i!==document&&(u.parentNode[F]._isOutsideThisEl(t.target),!yt&&lt(t)),!l.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),y=!0}function H(){L=R(u),et=R(u,l.draggable),P({sortable:m,name:"change",toEl:e,newIndex:L,newDraggableIndex:et,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),i=q(i,l.draggable,e,!0),B("dragOver"),v.eventCanceled)return y;if(u.contains(t.target)||i.animated&&i.animatingX&&i.animatingY||m._ignoreWhileAnimating===i)return A(!1);if(Jt=!1,d&&!l.disabled&&(h?s||(a=k!==E):T===this||(this.lastPutMode=Ht.checkPull(this,d,u,t))&&c.checkPut(this,d,u,t))){if(g=this._getDirection(t,i)==="vertical",o=C(u),B("dragOverValid"),v.eventCanceled)return y;if(a)return k=E,G(),this._hideClone(),B("revert"),v.eventCanceled||(ct?E.insertBefore(u,ct):E.appendChild(u)),A(!0);var $=ye(e,l.draggable);if(!$||Fi(t,g,this)&&!$.animated){if($===u)return A(!1);if($&&e===t.target&&(i=$),i&&(r=C(i)),qt(E,e,u,o,i,r,t,!!i)!==!1)return G(),$&&$.nextSibling?e.insertBefore(u,$.nextSibling):e.appendChild(u),k=e,H(),A(!0)}else if($&&Li(t,g,this)){var ot=gt(e,0,l,!0);if(ot===u)return A(!1);if(i=ot,r=C(i),qt(E,e,u,o,i,r,t,!1)!==!1)return G(),e.insertBefore(u,ot),k=e,H(),A(!0)}else if(i.parentNode===e){r=C(i);var j=0,rt,mt=u.parentNode!==e,M=!Pi(u.animated&&u.toRect||o,i.animated&&i.toRect||r,g),vt=g?"top":"left",Q=Ye(i,"top","top")||Ye(u,"top","top"),bt=Q?Q.scrollTop:void 0;ut!==i&&(rt=r[vt],Ot=!1,Wt=!M&&l.invertSwap||mt),j=Ri(t,i,r,g,M?1:l.swapThreshold,l.invertedSwapThreshold==null?l.swapThreshold:l.invertedSwapThreshold,Wt,ut===i);var z;if(j!==0){var at=R(u);do at-=j,z=k.children[at];while(z&&(p(z,"display")==="none"||z===b))}if(j===0||z===i)return A(!1);ut=i,Nt=j;var _t=i.nextElementSibling,Z=!1;Z=j===1;var xt=qt(E,e,u,o,i,r,t,Z);if(xt!==!1)return(xt===1||xt===-1)&&(Z=xt===1),me=!0,setTimeout(Ui,30),G(),Z&&!_t?e.appendChild(u):i.parentNode.insertBefore(u,Z?_t:i),Q&&oi(Q,0,bt-Q.scrollTop),k=u.parentNode,rt!==void 0&&!Wt&&(Gt=Math.abs(rt-C(i)[vt])),H(),A(!0)}if(e.contains(u))return A(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){_(document,"mousemove",this._onTouchMove),_(document,"touchmove",this._onTouchMove),_(document,"pointermove",this._onTouchMove),_(document,"dragover",lt),_(document,"mousemove",lt),_(document,"touchmove",lt)},_offUpEvents:function(){var t=this.el.ownerDocument;_(t,"mouseup",this._onDrop),_(t,"touchend",this._onDrop),_(t,"pointerup",this._onDrop),_(t,"touchcancel",this._onDrop),_(document,"selectstart",this)},_onDrop:function(t){var e=this.el,i=this.options;if(L=R(u),et=R(u,i.draggable),x("drop",this,{evt:t}),k=u&&u.parentNode,L=R(u),et=R(u,i.draggable),v.eventCanceled){this._nulling();return}ft=!1,Wt=!1,Ot=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),ve(this.cloneId),ve(this._dragStartId),this.nativeDraggable&&(_(document,"drop",this),_(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),It&&p(document.body,"user-select",""),p(u,"transform",""),t&&(St&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),b&&b.parentNode&&b.parentNode.removeChild(b),(E===k||T&&T.lastPutMode!=="clone")&&S&&S.parentNode&&S.parentNode.removeChild(S),u&&(this.nativeDraggable&&_(u,"dragend",this),fe(u),u.style["will-change"]="",St&&!ft&&U(u,T?T.options.ghostClass:this.options.ghostClass,!1),U(u,this.options.chosenClass,!1),P({sortable:this,name:"unchoose",toEl:k,newIndex:null,newDraggableIndex:null,originalEvent:t}),E!==k?(L>=0&&(P({rootEl:k,name:"add",toEl:k,fromEl:E,originalEvent:t}),P({sortable:this,name:"remove",toEl:k,originalEvent:t}),P({rootEl:k,name:"sort",toEl:k,fromEl:E,originalEvent:t}),P({sortable:this,name:"sort",toEl:k,originalEvent:t})),T&&T.save()):L!==ht&&L>=0&&(P({sortable:this,name:"update",toEl:k,originalEvent:t}),P({sortable:this,name:"sort",toEl:k,originalEvent:t})),v.active&&((L==null||L===-1)&&(L=ht,et=Tt),P({sortable:this,name:"end",toEl:k,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){x("nulling",this),E=u=k=b=ct=S=Yt=it=st=W=St=L=et=ht=Tt=ut=Nt=T=Ht=v.dragged=v.ghost=v.clone=v.active=null,Zt.forEach(function(t){t.checked=!0}),Zt.length=ce=de=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":u&&(this._onDragOver(t),Mi(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],e,i=this.el.children,o=0,r=i.length,a=this.options;o<r;o++)e=i[o],q(e,a.draggable,this.el,!1)&&t.push(e.getAttribute(a.dataIdAttr)||Hi(e));return t},sort:function(t,e){var i={},o=this.el;this.toArray().forEach(function(r,a){var l=o.children[a];q(l,this.options.draggable,o,!1)&&(i[r]=l)},this),e&&this.captureAnimationState(),t.forEach(function(r){i[r]&&(o.removeChild(i[r]),o.appendChild(i[r]))}),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return q(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var i=this.options;if(e===void 0)return i[t];var o=Pt.modifyOption(this,t,e);typeof o<"u"?i[t]=o:i[t]=e,t==="group"&&li(i)},destroy:function(){x("destroy",this);var t=this.el;t[F]=null,_(t,"mousedown",this._onTapStart),_(t,"touchstart",this._onTapStart),_(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(_(t,"dragover",this),_(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Qt.splice(Qt.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!it){if(x("hideClone",this),v.eventCanceled)return;p(S,"display","none"),this.options.removeCloneOnHide&&S.parentNode&&S.parentNode.removeChild(S),it=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(it){if(x("showClone",this),v.eventCanceled)return;u.parentNode==E&&!this.options.group.revertClone?E.insertBefore(S,u):ct?E.insertBefore(S,ct):E.appendChild(S),this.options.group.revertClone&&this.animate(u,S),p(S,"display",""),it=!1}}};function Mi(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move"),n.cancelable&&n.preventDefault()}function qt(n,t,e,i,o,r,a,l){var c,d=n[F],h=d.options.onMove,s;return window.CustomEvent&&!J&&!At?c=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(c=document.createEvent("Event"),c.initEvent("move",!0,!0)),c.to=t,c.from=n,c.dragged=e,c.draggedRect=i,c.related=o||t,c.relatedRect=r||C(t),c.willInsertAfter=l,c.originalEvent=a,n.dispatchEvent(c),h&&(s=h.call(d,c,a)),s}function fe(n){n.draggable=!1}function Ui(){me=!1}function Li(n,t,e){var i=C(gt(e.el,0,e.options,!0)),o=ii(e.el),r=10;return t?n.clientX<o.left-r||n.clientY<i.top&&n.clientX<i.right:n.clientY<o.top-r||n.clientY<i.bottom&&n.clientX<i.left}function Fi(n,t,e){var i=C(ye(e.el,e.options.draggable)),o=ii(e.el),r=10;return t?n.clientX>o.right+r||n.clientY>i.bottom&&n.clientX>i.left:n.clientY>o.bottom+r||n.clientX>i.right&&n.clientY>i.top}function Ri(n,t,e,i,o,r,a,l){var c=i?n.clientY:n.clientX,d=i?e.height:e.width,h=i?e.top:e.left,s=i?e.bottom:e.right,f=!1;if(!a){if(l&&Gt<d*o){if(!Ot&&(Nt===1?c>h+d*r/2:c<s-d*r/2)&&(Ot=!0),Ot)f=!0;else if(Nt===1?c<h+Gt:c>s-Gt)return-Nt}else if(c>h+d*(1-o)/2&&c<s-d*(1-o)/2)return Bi(t)}return f=f||a,f&&(c<h+d*r/2||c>s-d*r/2)?c>h+d/2?1:-1:0}function Bi(n){return R(u)<R(n)?1:-1}function Hi(n){for(var t=n.tagName+n.className+n.src+n.href+n.textContent,e=t.length,i=0;e--;)i+=t.charCodeAt(e);return i.toString(36)}function Wi(n){Zt.length=0;for(var t=n.getElementsByTagName("input"),e=t.length;e--;){var i=t[e];i.checked&&Zt.push(i)}}function zt(n){return setTimeout(n,0)}function ve(n){return clearTimeout(n)}ee&&w(document,"touchmove",function(n){(v.active||ft)&&n.cancelable&&n.preventDefault()});v.utils={on:w,off:_,css:p,find:ei,is:function(t,e){return!!q(t,e,t,!1)},extend:Di,throttle:ni,closest:q,toggleClass:U,clone:ri,index:R,nextTick:zt,cancelNextTick:ve,detectDirection:si,getChild:gt};v.get=function(n){return n[F]};v.mount=function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];t[0].constructor===Array&&(t=t[0]),t.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(v.utils=Y(Y({},v.utils),i.utils)),Pt.mount(i)})};v.create=function(n,t){return new v(n,t)};v.version=wi;var I=[],Dt,be,_e=!1,he,pe,te,kt;function ji(){function n(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return n.prototype={dragStarted:function(e){var i=e.originalEvent;this.sortable.nativeDraggable?w(document,"dragover",this._handleAutoScroll):this.options.supportPointer?w(document,"pointermove",this._handleFallbackAutoScroll):i.touches?w(document,"touchmove",this._handleFallbackAutoScroll):w(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var i=e.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?_(document,"dragover",this._handleAutoScroll):(_(document,"pointermove",this._handleFallbackAutoScroll),_(document,"touchmove",this._handleFallbackAutoScroll),_(document,"mousemove",this._handleFallbackAutoScroll)),Je(),Kt(),ki()},nulling:function(){te=be=Dt=_e=kt=he=pe=null,I.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,i){var o=this,r=(e.touches?e.touches[0]:e).clientX,a=(e.touches?e.touches[0]:e).clientY,l=document.elementFromPoint(r,a);if(te=e,i||this.options.forceAutoScrollFallback||At||J||It){ge(e,this.options,l,i);var c=nt(l,!0);_e&&(!kt||r!==he||a!==pe)&&(kt&&Je(),kt=setInterval(function(){var d=nt(document.elementFromPoint(r,a),!0);d!==c&&(c=d,Kt()),ge(e,o.options,d,i)},10),he=r,pe=a)}else{if(!this.options.bubbleScroll||nt(l,!0)===X()){Kt();return}ge(e,this.options,nt(l,!1),!1)}}},V(n,{pluginName:"scroll",initializeByDefault:!0})}function Kt(){I.forEach(function(n){clearInterval(n.pid)}),I=[]}function Je(){clearInterval(kt)}var ge=ni(function(n,t,e,i){if(t.scroll){var o=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,a=t.scrollSensitivity,l=t.scrollSpeed,c=X(),d=!1,h;be!==e&&(be=e,Kt(),Dt=t.scroll,h=t.scrollFn,Dt===!0&&(Dt=nt(e,!0)));var s=0,f=Dt;do{var g=f,m=C(g),y=m.top,B=m.bottom,G=m.left,A=m.right,H=m.width,$=m.height,ot=void 0,j=void 0,rt=g.scrollWidth,mt=g.scrollHeight,M=p(g),vt=g.scrollLeft,Q=g.scrollTop;g===c?(ot=H<rt&&(M.overflowX==="auto"||M.overflowX==="scroll"||M.overflowX==="visible"),j=$<mt&&(M.overflowY==="auto"||M.overflowY==="scroll"||M.overflowY==="visible")):(ot=H<rt&&(M.overflowX==="auto"||M.overflowX==="scroll"),j=$<mt&&(M.overflowY==="auto"||M.overflowY==="scroll"));var bt=ot&&(Math.abs(A-o)<=a&&vt+H<rt)-(Math.abs(G-o)<=a&&!!vt),z=j&&(Math.abs(B-r)<=a&&Q+$<mt)-(Math.abs(y-r)<=a&&!!Q);if(!I[s])for(var at=0;at<=s;at++)I[at]||(I[at]={});(I[s].vx!=bt||I[s].vy!=z||I[s].el!==g)&&(I[s].el=g,I[s].vx=bt,I[s].vy=z,clearInterval(I[s].pid),(bt!=0||z!=0)&&(d=!0,I[s].pid=setInterval(function(){i&&this.layer===0&&v.active._onTouchMove(te);var _t=I[this.layer].vy?I[this.layer].vy*l:0,Z=I[this.layer].vx?I[this.layer].vx*l:0;typeof h=="function"&&h.call(v.dragged.parentNode[F],Z,_t,n,te,I[this.layer].el)!=="continue"||oi(I[this.layer].el,Z,_t)}.bind({layer:s}),24))),s++}while(t.bubbleScroll&&f!==c&&(f=nt(f,!1)));_e=d}},30),ui=function(t){var e=t.originalEvent,i=t.putSortable,o=t.dragEl,r=t.activeSortable,a=t.dispatchSortableEvent,l=t.hideGhostForTarget,c=t.unhideGhostForTarget;if(e){var d=i||r;l();var h=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,s=document.elementFromPoint(h.clientX,h.clientY);c(),d&&!d.el.contains(s)&&(a("spill"),this.onSpill({dragEl:o,putSortable:i}))}};function we(){}we.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var o=gt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(e,o):this.sortable.el.appendChild(e),this.sortable.animateAll(),i&&i.animateAll()},drop:ui};V(we,{pluginName:"revertOnSpill"});function Ee(){}Ee.prototype={onSpill:function(t){var e=t.dragEl,i=t.putSortable,o=i||this.sortable;o.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),o.animateAll()},drop:ui};V(Ee,{pluginName:"removeOnSpill"});v.mount(new ji);v.mount(Ee,we);var fi=v;globalThis.Sortable=fi;globalThis.loadProperties=Ie;globalThis.tr=Ce;
/*! Bundled license information:

imagesloaded/imagesloaded.js:
  (*!
   * imagesLoaded v5.0.0
   * JavaScript is all like "You images are done yet or what?"
   * MIT License
   *)

sortablejs/modular/sortable.esm.js:
  (**!
   * Sortable 1.15.1
   * @author	RubaXa   <trash@rubaxa.org>
   * @author	owenm    <owen23355@gmail.com>
   * @license MIT
   *)
*/
